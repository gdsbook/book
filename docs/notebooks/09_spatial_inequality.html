

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Spatial Inequality Analysis &#8212; Geographic Data Science with Python</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://geographicdata.science/book/notebooks/09_spatial_inequality.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Clustering and Regionalization" href="10_clustering_and_regionalization.html" />
    <link rel="prev" title="Point Pattern Analysis" href="08_point_pattern_analysis.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://geographicdata.science/book/notebooks/09_spatial_inequality.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Spatial Inequality Analysis" />
<meta property="og:description" content="Spatial Inequality Analysis  Introduction  At the time this is being written, the topic of inequality is at the top of agenda of policy makers and is drawing co" />
<meta property="og:image"       content="https://geographicdata.science/book/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Geographic Data Science with Python</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Geographic Data Science with PySAL and the PyData Stack
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part I - Building Blocks
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_part_i.html">
   Part I - Building Blocks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_geospatial_computational_environment.html">
   Computational Tools for Geographic Data Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_spatial_data.html">
   Spatial Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_spatial_data_processing.html">
   Spatial Data Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_spatial_weights.html">
   Spatial Weights
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part II - Spatial Data Analysis
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_part_ii.html">
   Part II - Spatial Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_choropleth.html">
   Choropleth Mapping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_spatial_autocorrelation.html">
   Global Spatial Autocorrelation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_local_autocorrelation.html">
   Local Spatial Autocorrelation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_point_pattern_analysis.html">
   Point Pattern Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_point_pattern_analysis.html#randomness-clustering">
   Randomness &amp; clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_point_pattern_analysis.html#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_point_pattern_analysis.html#questions">
   Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_point_pattern_analysis.html#references">
   References
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part III - Advanced Topics
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_part_ii.html">
   Part II - Spatial Data Analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Spatial Inequality Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_clustering_and_regionalization.html">
   Clustering and Regionalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_regression.html">
   Spatial regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_feature_engineering.html">
   Geographic feature engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_feature_engineering.html#what-is-spatial-feature-engineering">
   What is spatial feature engineering?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_feature_engineering.html#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_feature_engineering.html#questions">
   Questions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Datasets
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../data/README.html">
   Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/airbnb/regression_cleaning.html">
   Data cleaning of AirBnb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/airports/airports_cleaning.html">
   Airports Dataset Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/brexit/README.html">
   Brexit data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/countries/countries_cleaning.html">
   Cleaning of countries dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/h3_grid/build_sd_h3_grid.html">
   Build a
   <code class="docutils literal notranslate">
    <span class="pre">
     H3
    </span>
   </code>
   grid for the San Diego region
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/mexico/README.html">
   Mexico data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/nasadem/build_nasadem_sd.html">
   Build the
   <code class="docutils literal notranslate">
    <span class="pre">
     nasadem_sd
    </span>
   </code>
   extract
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/texas/README.html">
   Texas data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/tokyo/tokyo_cleaning.html">
   Tokyo Dataset
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/09_spatial_inequality.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/gdsbook/book/master?urlpath=lab/tree/notebooks/09_spatial_inequality.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/gdsbook/book/blob/master/notebooks/09_spatial_inequality.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-us-state-per-capita-income-1969-2017">
   Data: US State Per-Capita Income 1969-2017
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#global-inequality">
   Global Inequality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ratio">
     20:20 Ratio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gini-index">
     Gini Index
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#theil-s-index">
     Theil’s index
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#personal-versus-regional-income">
   Personal versus Regional Income
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spatial-inequality">
   Spatial Inequality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spatial-autocorrelation">
     Spatial Autocorrelation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decompositional-approaches">
     Decompositional Approaches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regional-inequality-decompositions">
     Regional Inequality Decompositions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regional-decomposition-of-inequality">
   Regional Decomposition of Inequality
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decomposition-using-states">
   Decomposition Using States
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intraregional-inequality">
     Intraregional inequality
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regional-inequality-between-states">
     Regional Inequality Between States
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spatializing-classic-measures">
     Spatializing Classic Measures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spatial-gini">
       Spatial Gini
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#spatial-20-20">
       Spatial 20:20
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rank-paths">
   Rank paths
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="spatial-inequality-analysis">
<h1>Spatial Inequality Analysis<a class="headerlink" href="#spatial-inequality-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>At the time this is being written, the topic of inequality is at the top of
agenda of policy makers and is drawing considerable attention in academic
circles. This is due to historic levels of inequality across the globe. Much of the focus has been on <em>interpersonal income inequality</em>,
yet there is a growing recognition that the question of <em>interregional income
inequality</em> requires further attention as the growing gaps between poor and rich
regions have been identified as key drivers of political polarization in
developing and developed countries <span class="bibtex" id="id1">[Rodriguez_Pose_2018]</span>.</p>
<p>Indeed, while the two literatures, personal and regional inequality, are
related, they have developed in a largely parallel fashion with limited
cross-fertilization. In this notebook, we examine how a spatially explicit focus
can provide insights on inequality and its dynamics. We also show the lineage of
regional inequality analysis to make explicit the linkage between it and the
older literature on personal inequality analysis.</p>
<p>We begin with an introduction to classic methods for interpersonal income
inequality analysis and how they have been adopted to the question of regional
inequalities. These include a number of graphical tools along side familiar
indices of inequality. As we discuss more fully, the use of these classical
methods in spatially referenced data, while useful in providing insights on some
of the aspects of spatial inequality, fails to fully capture the nature of
geographical disparities and their dynamics. Thus, we next move to spatially
explicit measures for regional inequality analysis. The notebook closes with
some recent extensions of some classical measures to more fully examine the
spatial dimensions of regional inequality dynamics.</p>
</div>
<div class="section" id="data-us-state-per-capita-income-1969-2017">
<h2>Data: US State Per-Capita Income 1969-2017<a class="headerlink" href="#data-us-state-per-capita-income-1969-2017" title="Permalink to this headline">¶</a></h2>
<p>We focus on the case of the United States over the
period  1969-2017.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">seaborn</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">pysal</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">mapclassify</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;../data/us_county_income/uscountypcincome.gpkg&#39;</span><span class="p">)</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>METDIVFP</th>
      <th>MTFCC</th>
      <th>NAME</th>
      <th>NAMELSAD</th>
      <th>Region</th>
      <th>STATEFP</th>
      <th>TableName</th>
      <th>Unit</th>
      <th>index</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3897</td>
      <td>3968</td>
      <td>4183</td>
      <td>4444</td>
      <td>4902</td>
      <td>5093</td>
      <td>5511</td>
      <td>5955</td>
      <td>6711</td>
      <td>7478</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Sauk</td>
      <td>Sauk County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-90.19196 43.55500, -90.19676 43.554...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3498</td>
      <td>3732</td>
      <td>3841</td>
      <td>4097</td>
      <td>4624</td>
      <td>4987</td>
      <td>5299</td>
      <td>5836</td>
      <td>6529</td>
      <td>7267</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Pierce</td>
      <td>Pierce County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-92.69454 44.68874, -92.69466 44.688...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3335</td>
      <td>3604</td>
      <td>3870</td>
      <td>4218</td>
      <td>4670</td>
      <td>5108</td>
      <td>5509</td>
      <td>6318</td>
      <td>6873</td>
      <td>7443</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>La Crosse</td>
      <td>La Crosse County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-91.34774 43.91196, -91.34874 43.912...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2740</td>
      <td>2953</td>
      <td>3275</td>
      <td>3482</td>
      <td>4014</td>
      <td>4335</td>
      <td>4733</td>
      <td>5169</td>
      <td>5885</td>
      <td>6323</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Dunn</td>
      <td>Dunn County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-92.13538 44.94481, -92.13538 44.944...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2711</td>
      <td>2936</td>
      <td>3289</td>
      <td>3720</td>
      <td>4214</td>
      <td>4588</td>
      <td>4923</td>
      <td>5512</td>
      <td>6067</td>
      <td>6383</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Jackson</td>
      <td>Jackson County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-91.16601 44.33510, -91.16600 44.335...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 77 columns</p>
</div></div></div>
</div>
<p>Inspection of the head of the data frame reveals that the years appear as columns in the data set, together with information about the particular record.
This format is an example of a <a class="reference external" href="https://www.theanalysisfactor.com/wide-and-long-data/"><em>wide</em> longitudinal data set</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="p">[[</span><span class="s1">&#39;LineCode&#39;</span><span class="p">,</span> <span class="s1">&#39;Descriptio&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LineCode</th>
      <th>Descriptio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>Per capita personal income (dollars) 2/</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>Per capita personal income (dollars) 2/</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Per capita personal income (dollars) 2/</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Per capita personal income (dollars) 2/</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>Per capita personal income (dollars) 2/</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">LineCode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>METDIVFP</th>
      <th>MTFCC</th>
      <th>NAME</th>
      <th>NAMELSAD</th>
      <th>Region</th>
      <th>STATEFP</th>
      <th>TableName</th>
      <th>Unit</th>
      <th>index</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3897</td>
      <td>3968</td>
      <td>4183</td>
      <td>4444</td>
      <td>4902</td>
      <td>5093</td>
      <td>5511</td>
      <td>5955</td>
      <td>6711</td>
      <td>7478</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Sauk</td>
      <td>Sauk County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-90.19196 43.55500, -90.19676 43.554...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3498</td>
      <td>3732</td>
      <td>3841</td>
      <td>4097</td>
      <td>4624</td>
      <td>4987</td>
      <td>5299</td>
      <td>5836</td>
      <td>6529</td>
      <td>7267</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Pierce</td>
      <td>Pierce County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-92.69454 44.68874, -92.69466 44.688...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3335</td>
      <td>3604</td>
      <td>3870</td>
      <td>4218</td>
      <td>4670</td>
      <td>5108</td>
      <td>5509</td>
      <td>6318</td>
      <td>6873</td>
      <td>7443</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>La Crosse</td>
      <td>La Crosse County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-91.34774 43.91196, -91.34874 43.912...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2740</td>
      <td>2953</td>
      <td>3275</td>
      <td>3482</td>
      <td>4014</td>
      <td>4335</td>
      <td>4733</td>
      <td>5169</td>
      <td>5885</td>
      <td>6323</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Dunn</td>
      <td>Dunn County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-92.13538 44.94481, -92.13538 44.944...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2711</td>
      <td>2936</td>
      <td>3289</td>
      <td>3720</td>
      <td>4214</td>
      <td>4588</td>
      <td>4923</td>
      <td>5512</td>
      <td>6067</td>
      <td>6383</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Jackson</td>
      <td>Jackson County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-91.16601 44.33510, -91.16600 44.335...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 77 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>METDIVFP</th>
      <th>MTFCC</th>
      <th>NAME</th>
      <th>NAMELSAD</th>
      <th>Region</th>
      <th>STATEFP</th>
      <th>TableName</th>
      <th>Unit</th>
      <th>index</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3897</td>
      <td>3968</td>
      <td>4183</td>
      <td>4444</td>
      <td>4902</td>
      <td>5093</td>
      <td>5511</td>
      <td>5955</td>
      <td>6711</td>
      <td>7478</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Sauk</td>
      <td>Sauk County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-90.19196 43.55500, -90.19676 43.554...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3498</td>
      <td>3732</td>
      <td>3841</td>
      <td>4097</td>
      <td>4624</td>
      <td>4987</td>
      <td>5299</td>
      <td>5836</td>
      <td>6529</td>
      <td>7267</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Pierce</td>
      <td>Pierce County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-92.69454 44.68874, -92.69466 44.688...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3335</td>
      <td>3604</td>
      <td>3870</td>
      <td>4218</td>
      <td>4670</td>
      <td>5108</td>
      <td>5509</td>
      <td>6318</td>
      <td>6873</td>
      <td>7443</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>La Crosse</td>
      <td>La Crosse County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-91.34774 43.91196, -91.34874 43.912...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2740</td>
      <td>2953</td>
      <td>3275</td>
      <td>3482</td>
      <td>4014</td>
      <td>4335</td>
      <td>4733</td>
      <td>5169</td>
      <td>5885</td>
      <td>6323</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Dunn</td>
      <td>Dunn County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-92.13538 44.94481, -92.13538 44.944...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2711</td>
      <td>2936</td>
      <td>3289</td>
      <td>3720</td>
      <td>4214</td>
      <td>4588</td>
      <td>4923</td>
      <td>5512</td>
      <td>6067</td>
      <td>6383</td>
      <td>...</td>
      <td>None</td>
      <td>G4020</td>
      <td>Jackson</td>
      <td>Jackson County</td>
      <td>3</td>
      <td>55</td>
      <td>CAINC1</td>
      <td>Dollars</td>
      <td>NaN</td>
      <td>POLYGON ((-91.16601 44.33510, -91.16600 44.335...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 77 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3076, 77)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="p">[[</span><span class="s1">&#39;1969&#39;</span><span class="p">,</span> <span class="s1">&#39;STATEFP&#39;</span><span class="p">,</span> <span class="s1">&#39;COUNTYFP&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>STATEFP</th>
      <th>COUNTYFP</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3897</td>
      <td>55</td>
      <td>111</td>
      <td>POLYGON ((-90.19196 43.55500, -90.19676 43.554...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3498</td>
      <td>55</td>
      <td>093</td>
      <td>POLYGON ((-92.69454 44.68874, -92.69466 44.688...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3335</td>
      <td>55</td>
      <td>063</td>
      <td>POLYGON ((-91.34774 43.91196, -91.34874 43.912...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2740</td>
      <td>55</td>
      <td>033</td>
      <td>POLYGON ((-92.13538 44.94481, -92.13538 44.944...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2711</td>
      <td>55</td>
      <td>053</td>
      <td>POLYGON ((-91.16601 44.33510, -91.16600 44.335...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="global-inequality">
<h2>Global Inequality<a class="headerlink" href="#global-inequality" title="Permalink to this headline">¶</a></h2>
<p>We begin our examination of inequality by focusing on several global measures. Here, global means the measure is concerned with the overall, or a-spatial, nature of inequality. Several classic measures of inequality are available for this purpose.</p>
<p>In general terms, measures of inequality focus on the dispersion present in an income distribution. In the case of regional, or spatial, inequality the distributions are defined on average or per-capita incomes for a spatial unit, such as a county, census tract, or region. For the US counties, we can visualize the distribution of per capita incomes for the first year in the sample as follows:</p>
<p>To get a sense for the value distribution for per capita income, we can first discretize the distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span>  <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;1969&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_12_1.png" src="../_images/09_spatial_inequality_12_1.png" />
</div>
</div>
<p>The long right tail is a prominent feature of the distribution, and is common in the study of incomes. A key point to keep in mind here is that the unit of measurement in this data is a spatial aggregate - a county. By contrast, in the wider inequality literature the observational unit is typically a household or individual. In the latter distributions, the degree of skewness is often more pronounced, and this is because the regional distributions are based on averages obtained from the individual distributions.</p>
<p>The density is a powerful summary device that captures the overall morphology of the <em>value</em> distribution. At the same time, the density is silent on the underlying <em>spatial distribution</em> of county incomes. We can look at this second view of the distribution using a choropleth map:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysal.viz</span> <span class="kn">import</span> <span class="n">mapclassify</span>
<span class="n">pci_1969</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q5_1969</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">Quantiles</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;1969&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;Quantiles&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
             <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_17_0.png" src="../_images/09_spatial_inequality_17_0.png" />
</div>
</div>
<p>The choropleth and the kernel density provide different visual depictions of the distribution of county incomes. These are useful for developing an understanding of the overall  To gain more specific insights on the level of inequality in the distribution, we turn to a number of inequality indices.</p>
<div class="section" id="ratio">
<h3>20:20 Ratio<a class="headerlink" href="#ratio" title="Permalink to this headline">¶</a></h3>
<p>One commonly used measure of inequality in a distribution is the so called 20:20 ratio, which is defined as the ratio of the incomes at the 80th percentile over that at the 20th percentile:</p>
<!-- #endregion --><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q5_1969</span><span class="o">.</span><span class="n">bins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2445., 2864., 3247., 3673., 7841.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i_20_20</span> <span class="o">=</span> <span class="n">q5_1969</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">q5_1969</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">i_20_20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5022494887525562
</pre></div>
</div>
</div>
</div>
<p>In 1969 the richest 20% of the counties had an income that was 1.5 times the poorest 20% of the counties. The 20:20 ratio has the advantage of being robust to outliers at the top and the bottom of the distribution.</p>
<p>We can examine the dynamics of this global inequality measure by creating a simple function to apply to all years in our time series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ineq_2020</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">q5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">Quantiles</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q5</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">q5</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span> <span class="mi">2018</span><span class="p">))</span>
<span class="n">i_20_20_all</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ineq_2020</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)])</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">i_20_20_all</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;20:20 ratio&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_24_0.png" src="../_images/09_spatial_inequality_24_0.png" />
</div>
</div>
<p>The ratio has a U-shaped pattern over time, bottoming out around 1994 after a long secular decline in the early period. Post 1994, however, the trend is one of increasing inequality up until 2013 where there is a turn towards lower income inequality between the counties.</p>
<p>For other classic measures of inequality, we will use the <code class="docutils literal notranslate"><span class="pre">inequality</span></code> package from <code class="docutils literal notranslate"><span class="pre">pysal</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysal.explore</span> <span class="kn">import</span> <span class="n">inequality</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="gini-index">
<h3>Gini Index<a class="headerlink" href="#gini-index" title="Permalink to this headline">¶</a></h3>
<p>The Gini index can be derived in a number of ways. Visually, the Gini is defined as the ratio of the area between
the line of equality and the Lorenze curve over the area below the line of equality, both of which are defined on a a two-dimensional space with population
percentiles on the x-axis and cumulative income on the vertical axis.</p>
<p>We can construct each of these as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">])[</span><span class="s1">&#39;1969&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Fn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span><span class="n">Fy</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span> <span class="n">Fn</span><span class="p">)</span>
<span class="c1">#plt.xlim(0, 1.0)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fe7b48fd550&gt;]
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_33_1.png" src="../_images/09_spatial_inequality_33_1.png" />
</div>
</div>
<p>The blue line is the Lorenze curve, and the Gini is the area between it and the 45-degree line of equality, expressed as a ratio over the area under the line of equality.</p>
<p>To examine how inequality evolves over time, we can create a function for the Lorenze curve:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lorenz</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">Fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Fn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
    <span class="k">return</span> <span class="n">Fy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lorenz</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.22486441e-04, 2.52956561e-04, 3.83636778e-04, ...,
       9.98429316e-01, 9.99176315e-01, 1.00000000e+00])
</pre></div>
</div>
</div>
</div>
<p>and then call this for each year in our sample:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lorenz_curves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">lorenz</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)])</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span><span class="n">Fn</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lorenz_curves</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_39_0.png" src="../_images/09_spatial_inequality_39_0.png" />
</div>
</div>
<p>The compression of the Lorenze curves makes it difficult to ascertain the temporal pattern in inequality. Focusing explicilty on the Gini coefficients may shed more light on this evolution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g69</span> <span class="o">=</span> <span class="n">inequality</span><span class="o">.</span><span class="n">gini</span><span class="o">.</span><span class="n">Gini</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g69</span><span class="o">.</span><span class="n">g</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.13556175504269904
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span> <span class="mi">2018</span><span class="p">)]</span>
<span class="n">ginis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inequality</span><span class="o">.</span><span class="n">gini</span><span class="o">.</span><span class="n">Gini</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">g</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">])</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gini_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([[</span><span class="n">years</span><span class="p">,</span> <span class="n">ginis</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Gini&#39;</span><span class="p">])</span>
<span class="n">gini_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gini_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">gini_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Gini</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1969</td>
      <td>0.135562</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1970</td>
      <td>0.130076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1971</td>
      <td>0.128540</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1972</td>
      <td>0.129126</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1973</td>
      <td>0.142166</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gini_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">gini_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
<span class="n">gini_df</span> <span class="o">=</span> <span class="n">gini_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">gini_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Gini&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_46_0.png" src="../_images/09_spatial_inequality_46_0.png" />
</div>
</div>
</div>
<div class="section" id="theil-s-index">
<h3>Theil’s index<a class="headerlink" href="#theil-s-index" title="Permalink to this headline">¶</a></h3>
<p>A third commonly used measure of inequality is Theil’s <span class="math notranslate nohighlight">\(T\)</span> given as:
$<span class="math notranslate nohighlight">\(T = \sum_{i=1}^m \left( \frac{y_i}{\sum_{i=1}^m y_i} \ln \left[ m \frac{y_i}{\sum_{i=1}^m y_i}\right] \right)\)</span><span class="math notranslate nohighlight">\(
where \)</span>y_i<span class="math notranslate nohighlight">\( is per-capita income in area \)</span>i<span class="math notranslate nohighlight">\( among \)</span>m$ areas. In PySAL, we can calculate this index each year as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gini_df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">Theil</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#gini_df.plot(figsize=(15,4))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">gini_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1">#gini_df.plot(y=[&#39;Gini&#39;, &#39;T&#39;], figsize=(15,4))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_49_0.png" src="../_images/09_spatial_inequality_49_0.png" />
</div>
</div>
<p>The time paths of the Gini and the Theil coefficients show striking
similarities, and, at first glance, this might suggest that the indices are
substitutes for one another. As we shall see below, however, each index has
properties that lend themselves to particular spatial extensions that provide
important complementarities.</p>
</div>
</div>
<div class="section" id="personal-versus-regional-income">
<h2>Personal versus Regional Income<a class="headerlink" href="#personal-versus-regional-income" title="Permalink to this headline">¶</a></h2>
<p>There is a subtle but important distinction between the study of personal and
regional income inequality. To see this, we first need to express the
relationships between the two types of inequality. Consider a country composed
of <span class="math notranslate nohighlight">\(N\)</span> individuals who are distributed over <span class="math notranslate nohighlight">\(m\)</span> regions. Let <span class="math notranslate nohighlight">\(Y_l\)</span> denote the
income of individual <span class="math notranslate nohighlight">\(l\)</span>. Total personal income in region <span class="math notranslate nohighlight">\(i\)</span> is given as <span class="math notranslate nohighlight">\(Y_i =
\sum_{l \in i} Y_l\)</span>. Per-capita income in region <span class="math notranslate nohighlight">\(i\)</span> is <span class="math notranslate nohighlight">\(y_i = \frac{Y_i}{N_i}\)</span>,
where <span class="math notranslate nohighlight">\(N_i\)</span> is the number of individuals in region <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>At the national level,  the coefficient of variation as an index of  interpersonal income inequality would be:</p>
<div class="math notranslate nohighlight">
\[CV_{nat} = \sqrt{\frac{\sum_{l=1}^N (Y_l - \bar{y})^2}{N}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{y}\)</span> is national per-capita income. The key component here is the sum
of squares term, and unpacking this sheds light on personal versus regional
inequality question:</p>
<div class="math notranslate nohighlight">
\[TSS = \sum_{l=1}^N (Y_l - \bar{y})^2\]</div>
<p>Focusing on an individual deviation: <span class="math notranslate nohighlight">\(\delta_l = Y_l - \bar{y}\)</span>, this is the contribution to inequality associated with individual <span class="math notranslate nohighlight">\(l\)</span>. We can break this into two components:</p>
<div class="math notranslate nohighlight">
\[\delta_l = (Y_l - y_i) +  (y_i - \bar{y})\]</div>
<p>The first term is the difference between the individual’s income and per-capita income in the individual’s region of residence, while the second term is the difference between the region’s per capita income and average national per capita income.</p>
<p>In regional studies, the intraregional personal income distribution is typically
not available. As a result, the assumption is often made that intraregional
personal inequality is zero. In other words, all individuals in the same region
have identical incomes. With this assumption in hand, the first term vanishes:
<span class="math notranslate nohighlight">\(Y_l -y_i = 0\)</span>, leading to:<a class="footnote-reference brackets" href="#reg" id="id2">1</a></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
TSS &amp;= \sum_{l=1}^N (Y_l - \bar{y})^2 \\
    &amp;= \sum_{l=1}^N \delta_l^2 \\
    &amp;= \sum_{l=1}^N ((Y_l - y_i) +  (y_i - \bar{y}))^2 \\
    &amp;= \sum_{l=1}^N (0 +  (y_i - \bar{y}))^2 \\
    &amp;= \sum_{i=1}^m\sum_{l \in i}  (y_i - \bar{y})^2 \\
    &amp;= \sum_{i=1}^m  [N_i(y_i - \bar{y})]^2
\end{aligned}
\end{split}\]</div>
<p>This means that each individual in a region has an equal contribution to the
overall level of national interpersonal inequality, given by <span class="math notranslate nohighlight">\((y_i - \bar{y})\)</span>,
while the region in question contributes <span class="math notranslate nohighlight">\(N_i(y_i - \bar{y})\)</span>. While it may seem
that the assumption of zero intraregional interepersonal income inequality is
overly restrictive, it serves to isolate the nature of interregional income
inequality. That is, inequality between places, rather than inequality between
people within those places. In essence, this strategy shifts the question up one
level in the spatial hierarchy by aggregating micro-level individual data to
areal units.</p>
</div>
<div class="section" id="spatial-inequality">
<h2>Spatial Inequality<a class="headerlink" href="#spatial-inequality" title="Permalink to this headline">¶</a></h2>
<p>The analysis of regional income inequality is distinguished from the analysis of
national interpersonal income inequality in its focus on spatial units. As
regional incomes are embedded in geographical space, it is important to consider
the special nature of spatial data. In the regional inequality literature this
has been approaches in a number of ways.</p>
<div class="section" id="spatial-autocorrelation">
<h3>Spatial Autocorrelation<a class="headerlink" href="#spatial-autocorrelation" title="Permalink to this headline">¶</a></h3>
<p>To get some insights on the spatial properties of regional income data, we can
turn to global measures of spatial autocorrelation that we encountered in
chapter XX. We use a queen spatial weights matrix to calculate Moran’s I for
each year in the sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">Queen</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">pci_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span><span class="o">.</span><span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3076
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MI</span> <span class="o">=</span> <span class="p">[</span><span class="n">pysal</span><span class="o">.</span><span class="n">explore</span><span class="o">.</span><span class="n">esda</span><span class="o">.</span><span class="n">moran</span><span class="o">.</span><span class="n">Moran</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span> <span class="n">wq</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="n">mi</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">mi</span><span class="o">.</span><span class="n">p_sim</span><span class="p">)</span> <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">MI</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(49, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span> <span class="o">=</span> <span class="n">gini_df</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;I pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[[</span><span class="s2">&quot;Gini&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I pvalue&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_60_0.png" src="../_images/09_spatial_inequality_60_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Gini&#39;, &#39;T&#39;, &#39;I&#39;, &#39;I pvalue&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Several patterns emerge from the time series of Moran’s I. First, the is a secular decline in the value of Moran’s I. Second, despite this decline,  there is never a year in which the spatial autocorrelation is not statistically significant. In other words, there is a strong spatial structure in the distribution of regional incomes that needs to be accounted for when focusing on inequality questions.</p>
</div>
<div class="section" id="decompositional-approaches">
<h3>Decompositional Approaches<a class="headerlink" href="#decompositional-approaches" title="Permalink to this headline">¶</a></h3>
<p>A popular approach to the analysis of inequality is to group the observations into mutually exclusive and exhaustive subsets in order to understand how much of the inequality is due to differences between members of the same subset versus between observations from different subsets. In the personal income literature, the groups have been defined in a number of ways: male vs. female, age cohorts, occupation types, race, etc. In regional applications, small areas are grouped into larger sets such that the resulting sets are spatially defined. <strong>Add notions of connected components here and link to other chapters where appropriate.</strong></p>
<!-- #region {"ein.tags": "worksheet-0", "slideshow": {"slide_type": "-"}} -->
</div>
<div class="section" id="regional-inequality-decompositions">
<h3>Regional Inequality Decompositions<a class="headerlink" href="#regional-inequality-decompositions" title="Permalink to this headline">¶</a></h3>
<p>One approach to incorporating spatial considerations into regional inequality extends this decompositional approach by using space to define the subgroups. This can be seen using   Theil’s <span class="math notranslate nohighlight">\(T\)</span>, which we encountered previously and decomposing the index  into so called <em>between</em> and <em>within</em> regional inequality components.</p>
<p>Applied to a collection of observations on  per capita incomes for <span class="math notranslate nohighlight">\(m\)</span> regional economies: <span class="math notranslate nohighlight">\(y = \left( y_1, y_2, \ldots, y_m \right)\)</span>, which are
are grouped into <span class="math notranslate nohighlight">\(\omega\)</span> mutually exclusive regions such that <span class="math notranslate nohighlight">\(\sum_{g=1}^{\omega} m_g=m\)</span>, where <span class="math notranslate nohighlight">\(m_g\)</span> is the number of areas
assigned to region <span class="math notranslate nohighlight">\(g\)</span>, Theil’s index from above can be rewritten as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
T &amp;= \sum_{i=1}^m \left( \frac{y_i}{\sum_{i=1}^m y_i} \ln \left[ m \frac{y_i}{\sum_{i=1}^m y_i}\right] \right) \\
  &amp;= \left[ \sum_{g=1}^{\omega} s_{g} log(\frac{m}{m_g} s_g)  \right] + \left[ \sum_{g=1}^{\omega} s_g \sum_{i \in g} s_{i,g} log(m_g s_{i,g}) \right] \\
  &amp;= B + W \\
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(s_g = \frac{\sum_{i \in g} y_i}{\sum_i y_i}\)</span>, and   <span class="math notranslate nohighlight">\(s_{i,g} = y_i / \sum_{i \in g} y_i\)</span>.</p>
<p>The first term is the between regions inequality component, and the second is
the within regions inequality component. The within region term is a weighted
average of inequality between economies belonging to the same region. Similar
to what is done above for the case of interpersonal inequality, the estimate of
the between region (group) component of the decomposition is based on setting
the incomes of all economies (individuals )belonging to a region (group) equal
to that of the regional (group) average of these per capita incomes. Now,
however, intraregional inequality between economies within the same region is
explicitly considered in the second component.<a class="footnote-reference brackets" href="#weight" id="id3">2</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;1969&#39;, &#39;1970&#39;, &#39;1971&#39;, &#39;1972&#39;, &#39;1973&#39;, &#39;1974&#39;, &#39;1975&#39;, &#39;1976&#39;, &#39;1977&#39;,
       &#39;1978&#39;, &#39;1979&#39;, &#39;1980&#39;, &#39;1981&#39;, &#39;1982&#39;, &#39;1983&#39;, &#39;1984&#39;, &#39;1985&#39;, &#39;1986&#39;,
       &#39;1987&#39;, &#39;1988&#39;, &#39;1989&#39;, &#39;1990&#39;, &#39;1991&#39;, &#39;1992&#39;, &#39;1993&#39;, &#39;1994&#39;, &#39;1995&#39;,
       &#39;1996&#39;, &#39;1997&#39;, &#39;1998&#39;, &#39;1999&#39;, &#39;2000&#39;, &#39;2001&#39;, &#39;2002&#39;, &#39;2003&#39;, &#39;2004&#39;,
       &#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;, &#39;2008&#39;, &#39;2009&#39;, &#39;2010&#39;, &#39;2011&#39;, &#39;2012&#39;, &#39;2013&#39;,
       &#39;2014&#39;, &#39;2015&#39;, &#39;2016&#39;, &#39;2017&#39;, &#39;ALAND&#39;, &#39;AWATER&#39;, &#39;CBSAFP&#39;, &#39;CLASSFP&#39;,
       &#39;COUNTYFP&#39;, &#39;COUNTYNS&#39;, &#39;CSAFP&#39;, &#39;Descriptio&#39;, &#39;Descript_1&#39;, &#39;FUNCSTAT&#39;,
       &#39;GEOID&#39;, &#39;GeoFIPS&#39;, &#39;GeoName&#39;, &#39;INTPTLAT&#39;, &#39;INTPTLON&#39;, &#39;IndustryCl&#39;,
       &#39;LSAD&#39;, &#39;LineCode&#39;, &#39;METDIVFP&#39;, &#39;MTFCC&#39;, &#39;NAME&#39;, &#39;NAMELSAD&#39;, &#39;Region&#39;,
       &#39;STATEFP&#39;, &#39;TableName&#39;, &#39;Unit&#39;, &#39;index&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 5, 8, 1, 2, 7, 4, 6])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_68_1.png" src="../_images/09_spatial_inequality_68_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region_df</span> <span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;STATEFP&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">region_df</span><span class="o">.</span><span class="n">Region</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([5, 6, 8, 7, 1, 2, 3, 4])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">region_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_71_0.png" src="../_images/09_spatial_inequality_71_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;1969&#39;, &#39;1970&#39;, &#39;1971&#39;, &#39;1972&#39;, &#39;1973&#39;, &#39;1974&#39;, &#39;1975&#39;, &#39;1976&#39;, &#39;1977&#39;,
       &#39;1978&#39;, &#39;1979&#39;, &#39;1980&#39;, &#39;1981&#39;, &#39;1982&#39;, &#39;1983&#39;, &#39;1984&#39;, &#39;1985&#39;, &#39;1986&#39;,
       &#39;1987&#39;, &#39;1988&#39;, &#39;1989&#39;, &#39;1990&#39;, &#39;1991&#39;, &#39;1992&#39;, &#39;1993&#39;, &#39;1994&#39;, &#39;1995&#39;,
       &#39;1996&#39;, &#39;1997&#39;, &#39;1998&#39;, &#39;1999&#39;, &#39;2000&#39;, &#39;2001&#39;, &#39;2002&#39;, &#39;2003&#39;, &#39;2004&#39;,
       &#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;, &#39;2008&#39;, &#39;2009&#39;, &#39;2010&#39;, &#39;2011&#39;, &#39;2012&#39;, &#39;2013&#39;,
       &#39;2014&#39;, &#39;2015&#39;, &#39;2016&#39;, &#39;2017&#39;, &#39;ALAND&#39;, &#39;AWATER&#39;, &#39;CBSAFP&#39;, &#39;CLASSFP&#39;,
       &#39;COUNTYFP&#39;, &#39;COUNTYNS&#39;, &#39;CSAFP&#39;, &#39;Descriptio&#39;, &#39;Descript_1&#39;, &#39;FUNCSTAT&#39;,
       &#39;GEOID&#39;, &#39;GeoFIPS&#39;, &#39;GeoName&#39;, &#39;INTPTLAT&#39;, &#39;INTPTLON&#39;, &#39;IndustryCl&#39;,
       &#39;LSAD&#39;, &#39;LineCode&#39;, &#39;METDIVFP&#39;, &#39;MTFCC&#39;, &#39;NAME&#39;, &#39;NAMELSAD&#39;, &#39;Region&#39;,
       &#39;STATEFP&#39;, &#39;TableName&#39;, &#39;Unit&#39;, &#39;index&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;New England&quot;</span><span class="p">,</span>
               <span class="s1">&#39;Mideast&#39;</span><span class="p">,</span> <span class="s1">&#39;Great Lakes&#39;</span><span class="p">,</span> <span class="s1">&#39;Plains&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Southeast&#39;</span><span class="p">,</span> <span class="s1">&#39;Southwest&#39;</span><span class="p">,</span> <span class="s1">&#39;Rocky Mountain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Far West&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">rdf</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">pci_df</span><span class="o">.</span><span class="n">Region</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
    <span class="n">rdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">region_names</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_74_0.png" src="../_images/09_spatial_inequality_74_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pci_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>ALAND</th>
      <th>AWATER</th>
      <th>LineCode</th>
      <th>index</th>
    </tr>
    <tr>
      <th>Region</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3736.208955</td>
      <td>3984.611940</td>
      <td>4238.238806</td>
      <td>4567.477612</td>
      <td>4959.328358</td>
      <td>5338.358209</td>
      <td>5740.134328</td>
      <td>6333.537313</td>
      <td>6846.955224</td>
      <td>7585.776119</td>
      <td>...</td>
      <td>48058.731343</td>
      <td>48107.701493</td>
      <td>50086.671642</td>
      <td>52201.611940</td>
      <td>53493.805970</td>
      <td>55414.552239</td>
      <td>2.423518e+09</td>
      <td>3.592977e+08</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3745.112360</td>
      <td>4003.943820</td>
      <td>4263.578652</td>
      <td>4608.359551</td>
      <td>5073.617978</td>
      <td>5534.668539</td>
      <td>5994.792135</td>
      <td>6485.730337</td>
      <td>7042.426966</td>
      <td>7773.331461</td>
      <td>...</td>
      <td>43304.949438</td>
      <td>43733.797753</td>
      <td>45401.174157</td>
      <td>47022.191011</td>
      <td>47930.286517</td>
      <td>49987.123596</td>
      <td>1.614247e+09</td>
      <td>1.943027e+08</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3426.800459</td>
      <td>3575.077982</td>
      <td>3863.880734</td>
      <td>4199.541284</td>
      <td>4795.082569</td>
      <td>5156.715596</td>
      <td>5668.309633</td>
      <td>6146.045872</td>
      <td>6720.729358</td>
      <td>7398.935780</td>
      <td>...</td>
      <td>36784.635321</td>
      <td>37842.667431</td>
      <td>38810.309633</td>
      <td>39864.006881</td>
      <td>40735.772936</td>
      <td>41918.071101</td>
      <td>1.441214e+09</td>
      <td>3.468585e+08</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3185.181230</td>
      <td>3463.689320</td>
      <td>3748.909385</td>
      <td>4273.289644</td>
      <td>5462.899676</td>
      <td>5389.299353</td>
      <td>5774.113269</td>
      <td>5824.689320</td>
      <td>6299.959547</td>
      <td>7291.336570</td>
      <td>...</td>
      <td>43098.207120</td>
      <td>44535.634304</td>
      <td>44770.778317</td>
      <td>44949.200647</td>
      <td>44198.533981</td>
      <td>44367.509709</td>
      <td>2.127329e+09</td>
      <td>5.344987e+07</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2611.549758</td>
      <td>2829.139130</td>
      <td>3062.237681</td>
      <td>3388.372947</td>
      <td>3833.672464</td>
      <td>4187.850242</td>
      <td>4487.303382</td>
      <td>4969.260870</td>
      <td>5389.129469</td>
      <td>6047.577778</td>
      <td>...</td>
      <td>32852.524638</td>
      <td>33231.090821</td>
      <td>34305.962319</td>
      <td>35476.280193</td>
      <td>36012.045411</td>
      <td>37209.981643</td>
      <td>1.301742e+09</td>
      <td>9.932303e+07</td>
      <td>3.0</td>
      <td>104.771429</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2968.305040</td>
      <td>3233.893899</td>
      <td>3443.859416</td>
      <td>3835.867374</td>
      <td>4486.610080</td>
      <td>4565.095491</td>
      <td>5182.435013</td>
      <td>5621.554377</td>
      <td>6045.092838</td>
      <td>6710.564987</td>
      <td>...</td>
      <td>37412.612732</td>
      <td>38892.190981</td>
      <td>41058.530504</td>
      <td>40829.559682</td>
      <td>39043.450928</td>
      <td>40153.835544</td>
      <td>3.842122e+09</td>
      <td>6.343465e+07</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3320.837209</td>
      <td>3642.600000</td>
      <td>3869.986047</td>
      <td>4407.576744</td>
      <td>5147.102326</td>
      <td>5597.353488</td>
      <td>5814.697674</td>
      <td>6090.674419</td>
      <td>6506.418605</td>
      <td>7408.781395</td>
      <td>...</td>
      <td>39290.641860</td>
      <td>40389.246512</td>
      <td>42126.865116</td>
      <td>43665.418605</td>
      <td>43188.325581</td>
      <td>44321.232558</td>
      <td>6.158906e+09</td>
      <td>7.368098e+07</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4026.353333</td>
      <td>4282.726667</td>
      <td>4605.933333</td>
      <td>5058.586667</td>
      <td>5621.780000</td>
      <td>6265.166667</td>
      <td>6749.706667</td>
      <td>7185.206667</td>
      <td>7694.146667</td>
      <td>8605.840000</td>
      <td>...</td>
      <td>39962.253333</td>
      <td>40579.226667</td>
      <td>42877.700000</td>
      <td>45247.820000</td>
      <td>46248.953333</td>
      <td>47928.013333</td>
      <td>7.392819e+09</td>
      <td>2.725763e+08</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 53 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regimes</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span> <span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;1969&#39;, &#39;1970&#39;, &#39;1971&#39;, &#39;1972&#39;, &#39;1973&#39;, &#39;1974&#39;, &#39;1975&#39;, &#39;1976&#39;, &#39;1977&#39;,
       &#39;1978&#39;, &#39;1979&#39;, &#39;1980&#39;, &#39;1981&#39;, &#39;1982&#39;, &#39;1983&#39;, &#39;1984&#39;, &#39;1985&#39;, &#39;1986&#39;,
       &#39;1987&#39;, &#39;1988&#39;, &#39;1989&#39;, &#39;1990&#39;, &#39;1991&#39;, &#39;1992&#39;, &#39;1993&#39;, &#39;1994&#39;, &#39;1995&#39;,
       &#39;1996&#39;, &#39;1997&#39;, &#39;1998&#39;, &#39;1999&#39;, &#39;2000&#39;, &#39;2001&#39;, &#39;2002&#39;, &#39;2003&#39;, &#39;2004&#39;,
       &#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;, &#39;2008&#39;, &#39;2009&#39;, &#39;2010&#39;, &#39;2011&#39;, &#39;2012&#39;, &#39;2013&#39;,
       &#39;2014&#39;, &#39;2015&#39;, &#39;2016&#39;, &#39;2017&#39;, &#39;ALAND&#39;, &#39;AWATER&#39;, &#39;LineCode&#39;, &#39;index&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span> <span class="o">=</span> <span class="n">rmeans</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ys</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">region_names</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>New England</th>
      <th>Mideast</th>
      <th>Great Lakes</th>
      <th>Plains</th>
      <th>Southeast</th>
      <th>Southwest</th>
      <th>Rocky Mountain</th>
      <th>Far West</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969</th>
      <td>3736.208955</td>
      <td>3745.112360</td>
      <td>3426.800459</td>
      <td>3185.181230</td>
      <td>2611.549758</td>
      <td>2968.305040</td>
      <td>3320.837209</td>
      <td>4026.353333</td>
    </tr>
    <tr>
      <th>1970</th>
      <td>3984.611940</td>
      <td>4003.943820</td>
      <td>3575.077982</td>
      <td>3463.689320</td>
      <td>2829.139130</td>
      <td>3233.893899</td>
      <td>3642.600000</td>
      <td>4282.726667</td>
    </tr>
    <tr>
      <th>1971</th>
      <td>4238.238806</td>
      <td>4263.578652</td>
      <td>3863.880734</td>
      <td>3748.909385</td>
      <td>3062.237681</td>
      <td>3443.859416</td>
      <td>3869.986047</td>
      <td>4605.933333</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>4567.477612</td>
      <td>4608.359551</td>
      <td>4199.541284</td>
      <td>4273.289644</td>
      <td>3388.372947</td>
      <td>3835.867374</td>
      <td>4407.576744</td>
      <td>5058.586667</td>
    </tr>
    <tr>
      <th>1973</th>
      <td>4959.328358</td>
      <td>5073.617978</td>
      <td>4795.082569</td>
      <td>5462.899676</td>
      <td>3833.672464</td>
      <td>4486.610080</td>
      <td>5147.102326</td>
      <td>5621.780000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rmeans</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmeans</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/serge/anaconda3/envs/gdsbook-jbupdate/lib/python3.8/site-packages/pandas/plotting/_matplotlib/core.py:1235: UserWarning: FixedFormatter should only be used together with FixedLocator
  ax.set_xticklabels(xticklabels)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_83_2.png" src="../_images/09_spatial_inequality_83_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="regional-decomposition-of-inequality">
<h2>Regional Decomposition of Inequality<a class="headerlink" href="#regional-decomposition-of-inequality" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theil_dr</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">explore</span><span class="o">.</span><span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">TheilD</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="n">ys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">regimes</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theil_dr</span><span class="o">.</span><span class="n">bg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.00914353, 0.00822696, 0.00782675, 0.00768201, 0.01022634,
       0.0081274 , 0.00783943, 0.00572543, 0.00560271, 0.0054971 ,
       0.00511791, 0.00566001, 0.00486877, 0.00466134, 0.00474425,
       0.00424528, 0.00428434, 0.00453503, 0.00465829, 0.00456699,
       0.00467363, 0.00412391, 0.00366334, 0.00342112, 0.00327131,
       0.00312475, 0.00326071, 0.00359733, 0.00327591, 0.00363014,
       0.00382409, 0.00436261, 0.00399156, 0.00402506, 0.00397   ,
       0.00394649, 0.00353368, 0.00362698, 0.00400508, 0.00449814,
       0.0043533 , 0.00470988, 0.0063954 , 0.00642426, 0.00694236,
       0.00644971, 0.00591871, 0.00554072, 0.00528702])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_dr</span><span class="o">.</span><span class="n">bg</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;wgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_dr</span><span class="o">.</span><span class="n">wg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;, &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;,
       &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;, &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;,
       &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;, &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_88_1.png" src="../_images/09_spatial_inequality_88_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">theil_drs</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">explore</span><span class="o">.</span><span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">TheilDSim</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="n">ys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">regimes</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgr_pvalue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_drs</span><span class="o">.</span><span class="n">bg_pvalue</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;, &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;,
       &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;, &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;,
       &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;, &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;,
       &lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;], dtype=object)
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_90_1.png" src="../_images/09_spatial_inequality_90_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgr_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgr_share&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_91_1.png" src="../_images/09_spatial_inequality_91_1.png" />
</div>
</div>
</div>
<div class="section" id="decomposition-using-states">
<h2>Decomposition Using States<a class="headerlink" href="#decomposition-using-states" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theil_ds</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">explore</span><span class="o">.</span><span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">TheilD</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="n">ys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;STATEFP&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theil_ds</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.02957171, 0.02729024, 0.02676375, 0.02733643, 0.03319636,
       0.0283834 , 0.02813178, 0.02221109, 0.02214933, 0.0214058 ,
       0.02189626, 0.02482284, 0.02221437, 0.02231788, 0.02363836,
       0.02279897, 0.02317035, 0.02364545, 0.02373745, 0.02526876,
       0.02380707, 0.02357123, 0.02206676, 0.02090373, 0.02177284,
       0.02056993, 0.02204564, 0.02281087, 0.02295751, 0.02473775,
       0.02590456, 0.02773321, 0.02628126, 0.02559679, 0.02485643,
       0.02541131, 0.02705721, 0.03097819, 0.03086718, 0.03144127,
       0.02556892, 0.02712277, 0.03203084, 0.0347429 , 0.0345323 ,
       0.03545746, 0.03393143, 0.03176903, 0.03099292])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theil_ds</span><span class="o">.</span><span class="n">bg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.01202777, 0.0109842 , 0.01061905, 0.01071478, 0.01461233,
       0.01174763, 0.01105986, 0.00815501, 0.00775988, 0.00777003,
       0.00712967, 0.00872701, 0.00756995, 0.00769952, 0.00794164,
       0.00740631, 0.0076062 , 0.00797162, 0.00823884, 0.00882419,
       0.00822823, 0.00749875, 0.00647523, 0.00599987, 0.00588984,
       0.00554096, 0.00588646, 0.00611652, 0.00608983, 0.00646834,
       0.00697106, 0.00771045, 0.00734962, 0.00735772, 0.00739003,
       0.00719904, 0.00701947, 0.00759011, 0.00812861, 0.0087168 ,
       0.00792982, 0.00889907, 0.01146766, 0.01226932, 0.01196   ,
       0.01128832, 0.01076909, 0.00978511, 0.00924435])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgs_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_ds</span><span class="o">.</span><span class="n">bg</span> <span class="o">/</span> <span class="n">theil_ds</span><span class="o">.</span><span class="n">T</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;bgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theil_ds</span><span class="o">.</span><span class="n">bg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[[</span><span class="s1">&#39;bgr&#39;</span><span class="p">,</span> <span class="s1">&#39;bgs&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_97_1.png" src="../_images/09_spatial_inequality_97_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[[</span><span class="s1">&#39;bgr_share&#39;</span><span class="p">,</span> <span class="s1">&#39;bgs_share&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_98_1.png" src="../_images/09_spatial_inequality_98_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[[</span><span class="s1">&#39;bgr_share&#39;</span><span class="p">,</span> <span class="s1">&#39;bgs_share&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bgr_share</th>
      <th>bgs_share</th>
      <th>T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bgr_share</th>
      <td>1.000000</td>
      <td>0.942346</td>
      <td>0.057387</td>
    </tr>
    <tr>
      <th>bgs_share</th>
      <td>0.942346</td>
      <td>1.000000</td>
      <td>0.184088</td>
    </tr>
    <tr>
      <th>T</th>
      <td>0.057387</td>
      <td>0.184088</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>A few patterns emerge from these figures. First, inequality between the states is larger than inequality between regions. Second, inequality within states is smaller than inequality within regions. Third, the time series patterns for the interregional components are similar for the BEA regions and state partitions of the counties. Finally, the correlation of between share and overall inequality is higher at the state level than for the BEA region level</p>
<div class="section" id="intraregional-inequality">
<h3>Intraregional inequality<a class="headerlink" href="#intraregional-inequality" title="Permalink to this headline">¶</a></h3>
<p>We can take a closer look at the within region inequality component by dissagregating the total value from XX into that occuring within each of the 8 regions. This can be done by calculating the global Theil index on the counties belonging to a given region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;New England&quot;</span><span class="p">,</span>
               <span class="s1">&#39;Mideast&#39;</span><span class="p">,</span> <span class="s1">&#39;Great Lakes&#39;</span><span class="p">,</span> <span class="s1">&#39;Plains&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Southeast&#39;</span><span class="p">,</span> <span class="s1">&#39;Southwest&#39;</span><span class="p">,</span> <span class="s1">&#39;Rocky Mountain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Far West&#39;</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="n">rdf</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">pci_df</span><span class="o">.</span><span class="n">Region</span><span class="o">==</span><span class="n">region</span><span class="p">]</span>
    <span class="c1">#rdf.plot()</span>
    <span class="c1">#print(region, len(pandas.unique(rdf.STATEFP)), rdf.shape[0])</span>
    <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">region</span><span class="p">,</span> <span class="n">region_names</span><span class="p">[</span><span class="n">region</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rdf</span><span class="o">.</span><span class="n">STATEFP</span><span class="p">)),</span> <span class="n">rdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="c1">#results.append(pysal.explore.inequality.theil.TheilDSim(rdf[ys].values, rdf.STATEFP,999))</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Region&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;States&quot;</span><span class="p">,</span> <span class="s2">&quot;Counties&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Region</th>
      <th>Name</th>
      <th>States</th>
      <th>Counties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>New England</td>
      <td>6</td>
      <td>67</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Mideast</td>
      <td>6</td>
      <td>178</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Great Lakes</td>
      <td>5</td>
      <td>436</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Plains</td>
      <td>7</td>
      <td>618</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Southeast</td>
      <td>12</td>
      <td>1035</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>Southwest</td>
      <td>4</td>
      <td>377</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>Rocky Mountain</td>
      <td>5</td>
      <td>215</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>Far West</td>
      <td>4</td>
      <td>150</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;New England&quot;</span><span class="p">,</span>
               <span class="s1">&#39;Mideast&#39;</span><span class="p">,</span> <span class="s1">&#39;Great Lakes&#39;</span><span class="p">,</span> <span class="s1">&#39;Plains&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Southeast&#39;</span><span class="p">,</span> <span class="s1">&#39;Southwest&#39;</span><span class="p">,</span> <span class="s1">&#39;Rocky Mountain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Far West&#39;</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="n">rdf</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="n">pci_df</span><span class="o">.</span><span class="n">Region</span><span class="o">==</span><span class="n">region</span><span class="p">]</span>
    <span class="c1">#rdf.plot()</span>
    <span class="c1">#print(region, len(pandas.unique(rdf.STATEFP)), rdf.shape[0])</span>
    <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">region</span><span class="p">,</span> <span class="n">region_names</span><span class="p">[</span><span class="n">region</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rdf</span><span class="o">.</span><span class="n">STATEFP</span><span class="p">)),</span> <span class="n">rdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pysal</span><span class="o">.</span><span class="n">explore</span><span class="o">.</span><span class="n">inequality</span><span class="o">.</span><span class="n">theil</span><span class="o">.</span><span class="n">TheilDSim</span><span class="p">(</span><span class="n">rdf</span><span class="p">[</span><span class="n">ys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">rdf</span><span class="o">.</span><span class="n">STATEFP</span><span class="p">,</span><span class="mi">999</span><span class="p">))</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span><span class="o">.</span><span class="n">bg_pvalue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001,
       0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001,
       0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001,
       0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001,
       0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001,
       0.001, 0.001, 0.001, 0.001])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.014585</td>
      <td>0.018776</td>
      <td>0.012075</td>
      <td>0.015233</td>
      <td>0.028121</td>
      <td>0.029590</td>
      <td>0.018616</td>
      <td>0.013005</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.013423</td>
      <td>0.018680</td>
      <td>0.010455</td>
      <td>0.015837</td>
      <td>0.024682</td>
      <td>0.025866</td>
      <td>0.020219</td>
      <td>0.013539</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.013806</td>
      <td>0.019843</td>
      <td>0.010493</td>
      <td>0.014355</td>
      <td>0.024555</td>
      <td>0.027463</td>
      <td>0.018711</td>
      <td>0.014485</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.014890</td>
      <td>0.019747</td>
      <td>0.010600</td>
      <td>0.016188</td>
      <td>0.023133</td>
      <td>0.032705</td>
      <td>0.019762</td>
      <td>0.014310</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.012113</td>
      <td>0.017861</td>
      <td>0.011965</td>
      <td>0.027926</td>
      <td>0.020529</td>
      <td>0.038443</td>
      <td>0.027356</td>
      <td>0.014854</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span> <span class="o">=</span> <span class="n">Tr</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">region_names</span><span class="p">)]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pinned0</span> <span class="o">=</span> <span class="n">Tr</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Tr</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pinned0</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()):</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># for adding legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;County Income Inequality Within BEA Regions (Relative to Year 0)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_114_0.png" src="../_images/09_spatial_inequality_114_0.png" />
</div>
</div>
<p>Unpacking the intraregional inequality term reveals that the original decomposition of inequality into within and between regions actually masks a great deal of heterogeneity in the internal inequality dynamics across the eight regions. Put another way, the overall trend in the aggregate within region component above is an average of the trends exhibited in each of the eight regions. There are two distinct groups of regions in this regard. The first consists of regions where the inequality between counties within each region has been increasing over the sample period. This group is composed of the New England,  Mideast, Far West, and Rocky Mountains regions. The second group are those regions where intraregional inequality has remained stable, or even decreased, over time. The Great Lakes, Southeast, and Southwest regions compose this group. The one outlier region is the Plains which does not fall neatly into either of these two groups.</p>
</div>
<div class="section" id="regional-inequality-between-states">
<h3>Regional Inequality Between States<a class="headerlink" href="#regional-inequality-between-states" title="Permalink to this headline">¶</a></h3>
<p>We can also ask if there is spatial heterogeneity in the inequality between counties from different states across each of the eight regions. That is, do states matter more in different regions?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bs</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">r</span><span class="o">.</span><span class="n">bg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bs</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(49, 8)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bs_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">region_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()):</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># for adding legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Between State Inequality as a Share of Intraregional Inequality&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_120_0.png" src="../_images/09_spatial_inequality_120_0.png" />
</div>
</div>
<p>In general terms, there is much more similarity across the regions in terms of inequality between the states. The between state share of inequality is the smaller component of inequality between the counties within each of the regions with the exception of the New England region.</p>
<!-- #region {"ein.tags": "worksheet-0", "slideshow": {"slide_type": "-"}} -->
</div>
<div class="section" id="spatializing-classic-measures">
<h3>Spatializing Classic Measures<a class="headerlink" href="#spatializing-classic-measures" title="Permalink to this headline">¶</a></h3>
<p>We now turn to two newer spatial analytics that extend a selction of the classic (a-spatial) inequality measures above to introduce a spatially explicit focus.</p>
<div class="section" id="spatial-gini">
<h4>Spatial Gini<a class="headerlink" href="#spatial-gini" title="Permalink to this headline">¶</a></h4>
<p>The first spatial extension was introduced by <span class="bibtex" id="id4">[Rey_2012]</span> and is designed to consider
the role of adjacency in a decomposition of the Gini index of inequality. More
specifically, The Gini in mean  is
$<span class="math notranslate nohighlight">\(G = \frac{\sum_i \sum_j \left | x_i - x_j \right|}{2 n^2 \bar{x}} \)</span><span class="math notranslate nohighlight">\(
and the spatial decomposition focuses on the numerator
\)</span><span class="math notranslate nohighlight">\(
\sum_i \sum_j \left |x_i - x_j \right | = \sum_i \sum_j \left( w_{i,j} \left |x_i - x_j \right | \right ) + \left( (1-w_{i,j})  \left |x_i - x_j \right | \right )
\)</span><span class="math notranslate nohighlight">\(
where \)</span>w_{i,j}<span class="math notranslate nohighlight">\( is an element of a binary spatial weights matrix indicating if observations \)</span>i<span class="math notranslate nohighlight">\( and \)</span>j$ are spatial neighbors. This results in</p>
<div class="math notranslate nohighlight">
\[G = \frac{\sum_i \sum_j w_{i,j}\left | x_i - x_j \right|}{2 n^2 \bar{x}} +   \frac{\sum_i \sum_j \left (1-w_{i,j} )| x_i - x_j \right|}{2 n^2 \bar{x}}. \]</div>
<p>The spatial Iini allows for a consideration of the spatial dependence in inequality. As this dependence increases, the second term of the spatial Gini can be expected to grow relative to the case where incomes are randomly distributed in space. Inference on the spatial Gini can be based on random spatial permutations of the income values, as we have seen elsewhere in this book.</p>
<p>The spatial Gini also provides a useful complement to the regional decomposition used in the Theil statistic. The latter does not consider pair-wise relationships between observations, while the spatial Gini does.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">inequality.gini</span> <span class="kn">import</span> <span class="n">Gini_Spatial</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>The spatial Gini takes a vector of incomes and a spatial weights object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span> <span class="o">=</span> <span class="n">Gini_Spatial</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="s1">&#39;1969&#39;</span><span class="p">],</span> <span class="n">wq</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span><span class="o">.</span><span class="n">g</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.13556175504269904
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs69</span><span class="o">.</span><span class="n">p_sim</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.01
</pre></div>
</div>
</div>
</div>
<p>The value is statistically significant for 1969, indicating that inequality between neighboring pairs of counties is different from the inequality between county paris that are not geographically proximate.</p>
<p>We can apply the same statistic over each year in the sample:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Gini_Spatial</span><span class="p">(</span><span class="n">pci_df</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">wq</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">gsi</span><span class="o">.</span><span class="n">e_wcg</span><span class="p">,</span> <span class="n">gsi</span><span class="o">.</span><span class="n">wcg</span><span class="p">,</span> <span class="n">gsi</span><span class="o">.</span><span class="n">z_wcg</span><span class="p">,</span> <span class="n">gsi</span><span class="o">.</span><span class="n">p_sim</span><span class="p">)</span> <span class="k">for</span> <span class="n">gsi</span> <span class="ow">in</span> <span class="n">gs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Extracting the z-values for the spatial Gini we see that the spatial dependence in the inequality is signficant in every year of the sample:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;z_wcg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gs_array</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z_wcg&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_135_1.png" src="../_images/09_spatial_inequality_135_1.png" />
</div>
</div>
</div>
<div class="section" id="spatial-20-20">
<h4>Spatial 20:20<a class="headerlink" href="#spatial-20-20" title="Permalink to this headline">¶</a></h4>
<p>The final analytics that we examine in this notebook are based on extending the classic 20:20 ratio to develop spatial visualizations.
As was seen earlier, the 20:20 ratio measures the gap in the incomes between the counties at the 80th and 20th percentiles of the income distirbution.
In the spatial 20:20 analytic, we can visualize and measure the geographical gap (separation) between these pair of counties.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ranks</span> <span class="o">=</span> <span class="n">pci_df</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="n">pci_df</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_rank&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pci_df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridx_20</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3077</span><span class="p">)</span>
<span class="n">ridx_80</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">3077</span><span class="p">)</span>
<span class="n">ridx_20</span><span class="p">,</span> <span class="n">ridx_80</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(615, 2461)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pci_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;1969_rank&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       2690.0
1       2208.0
2       1971.0
3       1040.0
4        992.0
         ...  
3071    1598.0
3072    3019.0
3073     635.0
3074    1924.0
3075    2848.0
Name: 1969_rank, Length: 3076, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;1969_rank&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">615</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2998]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx_20</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">idx_80</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_rank&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">idx_20_i</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">==</span><span class="n">ridx_20</span><span class="p">]</span>
    <span class="n">idx_20</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">idx_20_i</span><span class="p">)</span>
    <span class="n">idx_80_i</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">==</span><span class="n">ridx_80</span><span class="p">]</span>
    <span class="n">idx_80</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">idx_80_i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As an example of the spatial 20:20 view, we plot the pair of counties at the 20th and 80th percentile for the last period of the sample:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">idx_20</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx_80</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_145_1.png" src="../_images/09_spatial_inequality_145_1.png" />
</div>
</div>
<p>Because we will be interested in measuring the spatial separation between the 20:20 counties each period, we set the coordinate reference system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span><span class="n">Polygon</span>
<span class="n">geom</span><span class="o">=</span><span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mf">117.454361</span><span class="p">,</span><span class="mf">117.459880</span><span class="p">],[</span><span class="mf">38.8459879</span><span class="p">,</span><span class="mf">38.846255</span><span class="p">])]</span>
<span class="n">ldf</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">})</span>
<span class="n">ldf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3310</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">l</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">ldf</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/serge/anaconda3/envs/gdsbook-jbupdate/lib/python3.8/site-packages/pyproj/crs/crs.py:53: FutureWarning: &#39;+init=&lt;authority&gt;:&lt;code&gt;&#39; syntax is deprecated. &#39;&lt;authority&gt;:&lt;code&gt;&#39; is the preferred initialization method. When making the change, be mindful of axis order changes: https://pyproj4.github.io/pyproj/stable/gotchas.html#axis-order-changes-in-proj-6
  return _prepare_from_string(&quot; &quot;.join(pjargs))
/home/serge/anaconda3/envs/gdsbook-jbupdate/lib/python3.8/site-packages/geopandas/base.py:39: UserWarning: The indices of the two GeoSeries are different.
  warn(&quot;The indices of the two GeoSeries are different.&quot;)
&lt;ipython-input-224-65f15989da07&gt;:6: UserWarning: Geometry is in a geographic CRS. Results from &#39;distance&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  l=gdf.distance(ldf.shift())
&lt;ipython-input-224-65f15989da07&gt;:6: UserWarning: CRS mismatch between the CRS of left geometries and the CRS of right geometries.
Use `to_crs()` to reproject one of the input geometries to match the CRS of the other.

Left CRS: EPSG:4269
Right CRS: None

  l=gdf.distance(ldf.shift())
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ldf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/serge/anaconda3/envs/gdsbook-jbupdate/lib/python3.8/site-packages/pyproj/crs/crs.py:53: FutureWarning: &#39;+init=&lt;authority&gt;:&lt;code&gt;&#39; syntax is deprecated. &#39;&lt;authority&gt;:&lt;code&gt;&#39; is the preferred initialization method. When making the change, be mindful of axis order changes: https://pyproj4.github.io/pyproj/stable/gotchas.html#axis-order-changes-in-proj-6
  return _prepare_from_string(&quot; &quot;.join(pjargs))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">idx_20</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx_80</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_149_1.png" src="../_images/09_spatial_inequality_149_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ldf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3310</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">idx_20</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx_80</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_151_1.png" src="../_images/09_spatial_inequality_151_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small</span> <span class="o">=</span> <span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">idx_20</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx_80</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1969</th>
      <th>1970</th>
      <th>1971</th>
      <th>1972</th>
      <th>1973</th>
      <th>1974</th>
      <th>1975</th>
      <th>1976</th>
      <th>1977</th>
      <th>1978</th>
      <th>...</th>
      <th>2008_rank</th>
      <th>2009_rank</th>
      <th>2010_rank</th>
      <th>2011_rank</th>
      <th>2012_rank</th>
      <th>2013_rank</th>
      <th>2014_rank</th>
      <th>2015_rank</th>
      <th>2016_rank</th>
      <th>2017_rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2067</th>
      <td>2524</td>
      <td>2822</td>
      <td>2889</td>
      <td>3272</td>
      <td>4291</td>
      <td>4187</td>
      <td>4692</td>
      <td>4866</td>
      <td>4838</td>
      <td>5573</td>
      <td>...</td>
      <td>443.0</td>
      <td>368.0</td>
      <td>413.0</td>
      <td>565.0</td>
      <td>677.0</td>
      <td>793.0</td>
      <td>911.0</td>
      <td>671.0</td>
      <td>336.0</td>
      <td>615.0</td>
    </tr>
    <tr>
      <th>680</th>
      <td>3995</td>
      <td>4184</td>
      <td>4537</td>
      <td>4845</td>
      <td>5564</td>
      <td>6200</td>
      <td>6258</td>
      <td>7134</td>
      <td>7950</td>
      <td>8711</td>
      <td>...</td>
      <td>2420.0</td>
      <td>2307.0</td>
      <td>2329.0</td>
      <td>2283.0</td>
      <td>2418.0</td>
      <td>2270.0</td>
      <td>2359.0</td>
      <td>2362.0</td>
      <td>2404.0</td>
      <td>2461.0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 126 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">small</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-231-922e47d448fd&gt;:1: UserWarning: CRS mismatch between the CRS of left geometries and the CRS of right geometries.
Use `to_crs()` to reproject one of the input geometries to match the CRS of the other.

Left CRS: EPSG:3310
Right CRS: None

  small.distance(small.shift()).values[-1]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1138976.2714209638
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2067    POINT (1951075.397 -92377.593)
680     POINT (2879450.626 655746.752)
dtype: geometry
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idxs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx_20</span><span class="p">,</span> <span class="n">idx_80</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
    <span class="n">o</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="n">idx</span>
    <span class="c1">#print(o,d, idx)</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-233-eb6290d6ddcc&gt;:7: UserWarning: Geometry is in a geographic CRS. Results from &#39;distance&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  d = pair.distance(pair.shift()).values[-1]
&lt;ipython-input-233-eb6290d6ddcc&gt;:7: UserWarning: CRS mismatch between the CRS of left geometries and the CRS of right geometries.
Use `to_crs()` to reproject one of the input geometries to match the CRS of the other.

Left CRS: EPSG:4269
Right CRS: None

  d = pair.distance(pair.shift()).values[-1]
</pre></div>
</div>
</div>
</div>
<p>Visualizing the  plot the of the 20:20 distances, reveals a secular decline in the distances separating these pair of counties over time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idxs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx_20</span><span class="p">,</span> <span class="n">idx_80</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">idxs</span><span class="p">))</span>
<span class="n">gini_df</span><span class="p">[</span><span class="s1">&#39;s_dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gini_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;s_dist&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_159_1.png" src="../_images/09_spatial_inequality_159_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="rank-paths">
<h2>Rank paths<a class="headerlink" href="#rank-paths" title="Permalink to this headline">¶</a></h2>
<p>A final analytic that we use to examine the spatial distribution of inequality across US counties is the evolution of the rank paths for the 20:20 ratio.
The rank path traces out the migration of a particular rank in the county income distribution over time <span class="bibtex" id="id5">[Rey_2020]</span>. To construct the rank paths for the 20:20 counties, we first plot the centroids:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idxs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">idx_20</span><span class="p">,</span> <span class="n">idx_80</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-237-292019a15e60&gt;:2: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  df.loc[idxs[:,0],:].centroid.plot(ax=ax, color=&#39;r&#39;)
&lt;ipython-input-237-292019a15e60&gt;:3: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  df.loc[idxs[:,1],:].centroid.plot(ax=ax, color=&#39;b&#39;)
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_162_1.png" src="../_images/09_spatial_inequality_162_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-238-4e7a11c11f83&gt;:2: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  df.loc[idxs[:,0],:].centroid.plot(ax=ax, color=&#39;r&#39;)
&lt;ipython-input-238-4e7a11c11f83&gt;:3: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  df.loc[idxs[:,1],:].centroid.plot(ax=ax, color=&#39;b&#39;)
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_164_1.png" src="../_images/09_spatial_inequality_164_1.png" />
</div>
</div>
<p>Next, a directed edge connects the centroids of the two states that held a specific rank in a pair of consecutive periods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">LineString</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ls20</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
<span class="n">ls80</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-240-8b84f11b546c&gt;:1: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()))
&lt;ipython-input-240-8b84f11b546c&gt;:2: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
<span class="n">ls20</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;20p&#39;</span><span class="p">)</span>
<span class="n">ls80</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1">#gdf.plot(ax=ax,edgecolor=&#39;gray&#39;, alpha=0.2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rank Paths (80pct Blue, 20pct Red)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/09_spatial_inequality_169_0.png" src="../_images/09_spatial_inequality_169_0.png" />
</div>
</div>
<p>The rank paths can also be constructed using a moving temporal window to provide a view of the evolution of the rank migrations over subsets of the sample period. Here we do so using a window of five years:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">rows</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_array</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">year</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ax_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_array</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">axes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_row</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1969</span><span class="o">+</span><span class="n">year</span><span class="p">,</span> <span class="mi">1969</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">43</span><span class="p">:</span>
            <span class="n">ls20</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="n">year</span><span class="p">:</span><span class="n">year</span><span class="o">+</span><span class="mi">5</span><span class="p">]))</span>
            <span class="n">ls20</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;20p&#39;</span><span class="p">)</span>
            <span class="n">ls80</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],:]</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="n">year</span><span class="p">:</span><span class="n">year</span><span class="o">+</span><span class="mi">5</span><span class="p">]))</span>
            <span class="n">ls80</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;20p&#39;</span><span class="p">)</span>
    
        <span class="n">year</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:11: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls20 = geopandas.GeoSeries(LineString(df.loc[idxs[:,0],:].centroid.tolist()[year:year+5]))
&lt;ipython-input-242-bf8d0746f32d&gt;:13: UserWarning: Geometry is in a geographic CRS. Results from &#39;centroid&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  ls80 = geopandas.GeoSeries(LineString(df.loc[idxs[:,1],:].centroid.tolist()[year:year+5]))
</pre></div>
</div>
<img alt="../_images/09_spatial_inequality_171_1.png" src="../_images/09_spatial_inequality_171_1.png" />
</div>
</div>
<p>Overall, there is a general north-south split for the 20 and 80 rank paths, with the wealthier part of the distribution being located more often in the northern section of the country.</p>
<hr class="docutils" />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
<!-- #endregion --><hr class="docutils" />
<dl class="footnote brackets">
<dt class="label" id="reg"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>It should also be noted that even at the national scale, the analysis of interpersonal income inequality also relies on aggregate data grouping individuals into income cohorts. See, for example, <span class="bibtex" id="id6">[Piketty_2003]</span>.</p>
</dd>
<dt class="label" id="weight"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>The regional decomposition does not involve weighting the regions by their respective population. See  <span class="bibtex" id="id7">[Gluschenko_2018]</span> for further details.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="08_point_pattern_analysis.html" title="previous page">Point Pattern Analysis</a>
    <a class='right-next' id="next-link" href="10_clustering_and_regionalization.html" title="next page">Clustering and Regionalization</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Sergio J. Rey, Dani Arribas-Bel, Levi J. Wolf<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-146598819-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>