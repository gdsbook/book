

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Choropleth Mapping &#8212; Geographic Data Science with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-146598819-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-146598819-1');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/05_choropleth';</script>
    <link rel="canonical" href="https://geographicdata.science/book/notebooks/05_choropleth.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Global Spatial Autocorrelation" href="06_spatial_autocorrelation.html" />
    <link rel="prev" title="Overview" href="../intro_part_ii.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Home
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00_toc.html">Table of Contents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part I - Building Blocks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro_part_i.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_geo_thinking.html">Geographic Thinking for Data Scientists</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_geospatial_computational_environment.html">Computational Tools for Geographic Data Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_spatial_data.html">Spatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_spatial_weights.html">Spatial Weights</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part II - Spatial Data Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro_part_ii.html">Overview</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Choropleth Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_spatial_autocorrelation.html">Global Spatial Autocorrelation</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_local_autocorrelation.html">Local Spatial Autocorrelation</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_point_pattern_analysis.html">Point Pattern Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part III - Advanced Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro_part_iii.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_spatial_inequality.html">Spatial Inequality Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_clustering_and_regionalization.html">Clustering and Regionalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_regression.html">Spatial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_feature_engineering.html">Spatial Feature Engineering</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Endmatter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data/README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/airbnb/regression_cleaning.html">AirBnb</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/airports/airports_cleaning.html">Airports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/brexit/brexit_cleaning.html">Brexit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/countries/countries_cleaning.html">Countries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/ghsl/build_ghsl_extract.html">GHSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/h3_grid/build_sd_h3_grid.html">H3 Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/mexico/README.html">Mexico</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/nasadem/build_nasadem_sd.html">NASA DEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/sandiego/sandiego_tracts_cleaning.html">San Diego Tracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/texas/README.html">Texas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/tokyo/tokyo_cleaning.html">Tokyo Photographs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/us_county_income/README.html">US County Income 1969-2017</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/gdsbook/book/master?urlpath=lab/tree/notebooks/05_choropleth.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/gdsbook/book/blob/master/notebooks/05_choropleth.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/05_choropleth.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Choropleth Mapping</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#principles">Principles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-data-classification">Quantitative data classification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equal-intervals">Equal intervals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantiles">Quantiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-standard-deviation">Mean-standard deviation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-breaks">Maximum breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot">Boxplot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#head-tail-breaks">Head-tail breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jenks-caspall-breaks">Jenks-Caspall breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fisher-jenks-breaks">Fisher-Jenks breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#max-p">Max-p</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-classification-schemes">Comparing classification schemes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#color">Color</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-palettes">Sequential palettes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diverging-palettes">Diverging palettes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qualitative-palettes">Qualitative palettes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-topics">Advanced topics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-defined-choropleths">User-defined choropleths</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pooled-classifications">Pooled classifications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="choropleth-mapping">
<h1>Choropleth Mapping<a class="headerlink" href="#choropleth-mapping" title="Permalink to this headline">#</a></h1>
<p>Choropleths are geographic maps that display statistical information encoded
in a color palette. Choropleth maps play a prominent role in geographic data science as they allow
us to display non-geographic attributes or variables on a geographic map. The
word choropleth stems from the root “choro”, meaning “region”.
Choropleth maps represent data at the region level, and are appropriate for
areal unit data where each observation combines a value of an attribute and a
geometric figure, usually a polygon. Choropleth maps derive from an earlier era
where cartographers faced technological constraints that precluded the use of
unclassed maps where each unique attribute value could be represented by a
distinct symbol or color. Instead, attribute values were grouped into a smaller
number of classes, usually not more than 12. Each class was associated with a
unique symbol that was in turn applied to all observations with attribute values
falling in the class.</p>
<p>Although today these technological constraints are no longer binding, and
unclassed mapping is feasible, there are still good reasons for adopting a
classed approach. Chief among these is to reduce the cognitive load involved in
parsing the complexity of an unclassed map. A choropleth map reduces this
complexity by drawing upon statistical and visualization theory to provide an
effective representation of the spatial distribution of the attribute values
across the areal units.</p>
<section id="principles">
<h2>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">#</a></h2>
<p>The effectiveness of a choropleth map depends largely on the purpose of the map.
Which message you want to communicate will shape what options are preferable
over others. In this chapter we consider three dimensions over which putting
intentional thinking will pay off. Choropleth mapping thus revolves around: first,
selecting a number of groups smaller than <span class="math notranslate nohighlight">\(n\)</span> into which all values in our dataset
will be mapped to; second, identifying a classification algorithm that executes such
mapping, following some principle that is aligned with our interest; and third, once
we know into how many groups we are going to reduce all values in our data, which
color is assigned to each group to ensure it encodes the information we want to reflect.
In broad terms, the classification scheme
defines the number of classes as well as the rules for assignment; while a good
symbolization conveys information about the value differentiation across
classes.</p>
<p>In this chapter we first discuss the approaches used to classify attribute
values. This is followed by a (brief) overview of color theory and the implications of
different color schemes for effective map design. We combine theory and practice
by exploring how these concepts are implemented in different Python packages,
including <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>, and the Pysal federation of packages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">pysal</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="quantitative-data-classification">
<h2>Quantitative data classification<a class="headerlink" href="#quantitative-data-classification" title="Permalink to this headline">#</a></h2>
<p>Selecting the number of groups into which we want to assign the values in our data,
and how each value is assigned into a group can be seen as a classification problem.
Data classification considers the problem of
partitioning the attribute values into mutually exclusive and exhaustive
groups. The precise manner in which this is done will be a function of the
measurement scale of the attribute in question. For quantitative attributes
(ordinal, interval, ratio scales), the classes will have an explicit ordering.
More formally, the classification problem is to define class boundaries such
that</p>
<div class="math notranslate nohighlight">
\[
c_j &lt; y_i \le  c_{j+1} \ \forall y_i \in C_{j}
\]</div>
<p>where <span class="math notranslate nohighlight">\(y_i\)</span> is the
value of the attribute for spatial location <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span> is a class index, and <span class="math notranslate nohighlight">\(c_j\)</span>
represents the lower bound of interval <span class="math notranslate nohighlight">\(j\)</span>. Different classification schemes obtain from their definition of the class
boundaries. The choice of the classification scheme should take into
consideration the statistical distribution of the attribute values as well
as the goal of our map (e.g., highlight outliers vs. accurately depict the distribution of values).</p>
<p>To illustrate these considerations, we will examine regional income data for 32 Mexican states <span id="id1">[<a class="reference internal" href="references.html#id47" title="Sergio J. Rey and Myrna L. Sastré-Gutiérrez. Interregional inequality dynamics in mexico. Spatial Economic Analysis, 5(3):277–298, Sep 2010. URL: http://dx.doi.org/10.1080/17421772.2010.493955, doi:10.1080/17421772.2010.493955.">RSastreGutierrez10</a>]</span> in this chapter. The variable we focus on is per capita gross domestic product
for 1940 (<code class="docutils literal notranslate"><span class="pre">PCGDP1940</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mx</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;../data/mexico/mexicojoin.shp&quot;</span><span class="p">)</span>
<span class="n">mx</span><span class="p">[[</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;PCGDP1940&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR 1: PROJ: proj_create_from_database: Open of /opt/conda/share/proj failed
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAME</th>
      <th>PCGDP1940</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baja California Norte</td>
      <td>22361.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Baja California Sur</td>
      <td>9573.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Nayarit</td>
      <td>4836.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jalisco</td>
      <td>5309.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aguascalientes</td>
      <td>10384.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Which displays the following statistical distribution (in Figure 1).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot histogram</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># Add rug on horizontal axis</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">rugplot</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/66f0285dafe32a1b46c9fa92fa2f3817dc950f6e4e42354050a6094560b69d44.png" src="../_images/66f0285dafe32a1b46c9fa92fa2f3817dc950f6e4e42354050a6094560b69d44.png" />
</div>
</div>
<p>As we can see, the distribution is positively skewed as is common in regional income studies. In other words,
the mean exceeds the median (<code class="docutils literal notranslate"><span class="pre">50%</span></code>, in the table below), leading to the long right tail in the figure. As
we shall see, this skewness will have implications for the choice of choropleth
classification scheme.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count       32.000000
mean      7230.531250
std       5204.952883
min       1892.000000
25%       3701.750000
50%       5256.000000
75%       8701.750000
max      22361.000000
Name: PCGDP1940, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>For quantitative attributes we first sort the data by their value,
such that <span class="math notranslate nohighlight">\(x_0 \le x_2 \ldots \le x_{n-1}\)</span>. For a prespecified number of classes
<span class="math notranslate nohighlight">\(k\)</span>, the classification problem boils down to selecting <span class="math notranslate nohighlight">\(k-1\)</span> break points
along the sorted values that separate the values into mutually exclusive and
exhaustive groups.</p>
<p>In fact, the determination of the histogram above can
be viewed as one approach to this selection.
The method <code class="docutils literal notranslate"><span class="pre">seaborn.histplot</span></code> uses the matplotlib <code class="docutils literal notranslate"><span class="pre">hist</span></code>
function under the hood to determine the class boundaries and the counts of
observations in each class. In the figure, we have five classes which can be
extracted with an explicit call to the <code class="docutils literal notranslate"><span class="pre">hist</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">counts</span></code> object captures how many observations each category in the classification has:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([17.,  9.,  3.,  1.,  2.])
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">bin</span></code> object stores these break points we are interested in when considering classification schemes (the <code class="docutils literal notranslate"><span class="pre">patches</span></code> object can be ignored in this context, as it stores the geometries of the histogram plot):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1892. ,  5985.8, 10079.6, 14173.4, 18267.2, 22361. ])
</pre></div>
</div>
</div>
</div>
<p>This yields five bins, with the first having a lower bound of 1892 and an upper
bound of 5985.8 which contains 17 observations. The determination of the
interval width (<span class="math notranslate nohighlight">\(w\)</span>) and the number of bins in <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> is based on the Freedman-Diaconis rule <span id="id2">[<a class="reference internal" href="references.html#id6" title="David Freedman and Persi Diaconis. On the histogram as a density estimator: l 2 theory. Zeitschrift für Wahrscheinlichkeitstheorie und verwandte Gebiete, 57(4):453–476, 1981.">FD81</a>]</span>:</p>
<div class="math notranslate nohighlight">
\[
w = 2 * IQR * n^{-1/3}
\]</div>
<p>where <span class="math notranslate nohighlight">\(IQR\)</span> is the inter quartile
range of the attribute values. Given <span class="math notranslate nohighlight">\(w\)</span>, the number of bins (<span class="math notranslate nohighlight">\(k\)</span>) is:</p>
<div class="math notranslate nohighlight">
\[k = \dfrac{(max-min)}{w}\]</div>
<p>The choropleth literature has many alternative classification algorithms that follow criteria that can be of interest in different contexts, as they focus on different priorities. Below, we will focus on a few of them. To compute the classification, we will rely on the <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code> package of the Pysal family:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mapclassify</span>
</pre></div>
</div>
</div>
</div>
<section id="equal-intervals">
<h3>Equal intervals<a class="headerlink" href="#equal-intervals" title="Permalink to this headline">#</a></h3>
<p>The Freedman-Diaconis approach provides a rule to determine the width and, in
turn, the number of bins for the classification. This is a special case of a
more general classifier known as “equal intervals”, where each of the bins has
the same width in the value space. For a given value of <span class="math notranslate nohighlight">\(k\)</span>, equal intervals
classification splits the range of the attribute space into <span class="math notranslate nohighlight">\(k\)</span> equal length
intervals, with each interval having a width <span class="math notranslate nohighlight">\(w = \frac{x_0 - x_{n-1}}{k}\)</span>. Thus
the maximum class is <span class="math notranslate nohighlight">\((x_{n-1}-w, x_{n-1}]\)</span> and the first class is <span class="math notranslate nohighlight">\((-\infty,
x_{n-1} - (k-1)w]\)</span>.</p>
<p>Equal intervals have the dual advantages of simplicity and ease of
interpretation. However, this rule only considers the extreme values of the
distribution and, in some cases, this can result in one or more classes being
sparse. This is clearly the case in our income dataset, as the majority of the
values are placed into the first two classes leaving the last three classes
rather sparse:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ei5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">EqualInterval</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ei5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EqualInterval

      Interval         Count
----------------------------
[ 1892.00,  5985.80] |    17
( 5985.80, 10079.60] |     9
(10079.60, 14173.40] |     3
(14173.40, 18267.20] |     1
(18267.20, 22361.00] |     2
</pre></div>
</div>
</div>
</div>
<p>Note that each of the intervals, however, has equal width of
<span class="math notranslate nohighlight">\(w=4093.8\)</span>. It should also be noted that the first class is closed on the lower bound,
in contrast to the general approach defined above.</p>
</section>
<section id="quantiles">
<h3>Quantiles<a class="headerlink" href="#quantiles" title="Permalink to this headline">#</a></h3>
<p>To avoid the potential problem of sparse classes, the quantiles of
the distribution can be used to identify the class boundaries. Indeed, each
class will have approximately <span class="math notranslate nohighlight">\(\mid\frac{n}{k}\mid\)</span> observations using the quantile
classifier. If <span class="math notranslate nohighlight">\(k=5\)</span> the sample quintiles are used to define the upper limits of
each class resulting in the following classification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">Quantiles</span><span class="p">(</span><span class="n">mx</span><span class="o">.</span><span class="n">PCGDP1940</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">q5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantiles

      Interval         Count
----------------------------
[ 1892.00,  3576.20] |     7
( 3576.20,  4582.80] |     6
( 4582.80,  6925.20] |     6
( 6925.20,  9473.00] |     6
( 9473.00, 22361.00] |     7
</pre></div>
</div>
</div>
</div>
<p>Note that while the numbers of values in each class are roughly equal, the
widths of the first four intervals are rather different:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q5</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">q5</span><span class="o">.</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1006.6,  2342.4,  2547.8, 12888. ])
</pre></div>
</div>
</div>
</div>
<p>While quantile classification avoids the pitfall of sparse classes, this classification is
not problem-free. The varying widths of the intervals can be markedly different
which can lead to problems of interpretation. A second challenge facing quantiles
arises when there are a large number of duplicate values in the distribution
such that the limits for one or more classes become ambiguous. For example, if one had a variable with <span class="math notranslate nohighlight">\(n=20\)</span> but 10 of the observations took on the same value which was the minimum observed, then for values of <span class="math notranslate nohighlight">\(k&gt;2\)</span>, the class boundaries become ill-defined since a simple rule of splitting at the <span class="math notranslate nohighlight">\(n/k\)</span> ranked observed value would depend upon how ties are treated when ranking.</p>
<p>Let us generate a synthetic variable with these characteristics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set seed for reproducibility</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="c1"># Generate a variable of 20 values randomly</span>
<span class="c1"># selected from 0 to 10</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># Manually ensure the first ten values are 0 (the</span>
<span class="c1"># minimum value)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 7, 6, 0, 2, 9, 1, 2, 6, 7])
</pre></div>
</div>
</div>
</div>
<p>And we will now run quantile classification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ties</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">Quantiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ties</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantiles

  Interval     Count
--------------------
[0.00, 0.00] |    11
(0.00, 1.40] |     1
(1.40, 6.20] |     4
(6.20, 9.00] |     4
</pre></div>
</div>
</div>
</div>
<p>For clarity, the unique values in our dataset are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ux</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ux</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 6, 7, 9])
</pre></div>
</div>
</div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code> will issue a warning alerting the user to the issue that this sample does not contain enough unique values to form
the number of well-defined classes requested.  It then forms a lower number of classes using pseudo-quantiles, or quantiles defined on the unique values in the sample, and then uses the pseudo-quantiles to classify all the values.</p>
</section>
<section id="mean-standard-deviation">
<h3>Mean-standard deviation<a class="headerlink" href="#mean-standard-deviation" title="Permalink to this headline">#</a></h3>
<p>Our third classifier uses the sample mean <span class="math notranslate nohighlight">\(\bar{x} =
\frac{1}{n} \sum_{i=1}^n x_i\)</span> and sample standard deviation <span class="math notranslate nohighlight">\(s = \sqrt{
\frac{1}{n-1} \sum_{i=1}^n (x_i - \bar{x})  }\)</span> to define class boundaries as
some distance from the sample mean, with the distance being a multiple of the
standard deviation. For example, a common definition for <span class="math notranslate nohighlight">\(k=5\)</span> is to set the
upper limit of the first class to two standard deviations (<span class="math notranslate nohighlight">\(c_{0}^u = \bar{x} - 2 s\)</span>), and the intermediate
classes to have upper limits within one standard deviation (<span class="math notranslate nohighlight">\(c_{1}^u = \bar{x}-s,\ c_{2}^u = \bar{x}+s, \ c_{3}^u
= \bar{x}+2s\)</span>). Any values greater (smaller) than two standard deviations above (below) the mean
are placed into the top (bottom) class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msd</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">StdMean</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">])</span>
<span class="n">msd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StdMean

      Interval         Count
----------------------------
(    -inf, -3179.37] |     0
(-3179.37,  2025.58] |     1
( 2025.58, 12435.48] |    28
(12435.48, 17640.44] |     0
(17640.44, 22361.00] |     3
</pre></div>
</div>
</div>
</div>
<p>This classifier is best used when data is normally distributed or, at least, when the sample mean is a meaningful measure to anchor the classification around. Clearly this is
not the case for our income data as the positive skew results in a loss of
information when we use the standard deviation. The lack of symmetry leads to
an inadmissible upper bound for the first  class as well as a concentration of the
vast majority of values in the middle class.</p>
</section>
<section id="maximum-breaks">
<h3>Maximum breaks<a class="headerlink" href="#maximum-breaks" title="Permalink to this headline">#</a></h3>
<p>The maximum breaks classifier decides where to set the break points between
classes by considering the difference between sorted values. That is, rather
than considering a value of the dataset in itself, it looks at how apart each
value is from the next one in the sorted sequence. The classifier then places
the <span class="math notranslate nohighlight">\(k-1\)</span> break points in between the pairs of values most stretched apart from
each other in the entire sequence, proceeding in descending order relative to
the size of the breaks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mb5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">MaximumBreaks</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">mb5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MaximumBreaks

      Interval         Count
----------------------------
[ 1892.00,  5854.00] |    17
( 5854.00, 11574.00] |    11
(11574.00, 14974.00] |     1
(14974.00, 19890.50] |     1
(19890.50, 22361.00] |     2
</pre></div>
</div>
</div>
</div>
<p>Maximum breaks is an appropriate approach when we are interested in making sure
observations in each class are separated from those in neighboring classes. As
such, it works well in cases where the distribution of values is not unimodal.
In addition, the algorithm is relatively fast to compute. However, its
simplicity can sometimes cause unexpected results. To the extent that maximum breaks classification only
considers the top <span class="math notranslate nohighlight">\(k-1\)</span> differences between consecutive values, other more nuanced
within-group differences and dissimilarities can be ignored.</p>
</section>
<section id="boxplot">
<h3>Boxplot<a class="headerlink" href="#boxplot" title="Permalink to this headline">#</a></h3>
<p>The boxplot classification is a blend of the quantile and
standard deviation classifiers. Here <span class="math notranslate nohighlight">\(k\)</span> is predefined to six, with the upper limit of the first class set
to:</p>
<div class="math notranslate nohighlight">
\[q_{0.25}-h \, IQR\]</div>
<p>where <span class="math notranslate nohighlight">\(IQR = q_{0.75}-q_{0.25}\)</span> is the
inter-quartile range; and <span class="math notranslate nohighlight">\(h\)</span> corresponds to the hinge, or the multiplier of the <span class="math notranslate nohighlight">\(IQR\)</span> to obtain the bounds of the “whiskers” from a box-and-whisker plot of the data. The lower limit of the sixth class is set to <span class="math notranslate nohighlight">\(q_{0.75}+h \,
IQR\)</span>. Intermediate classes have their upper limits set to the 0.25, 0.50 and
0.75 percentiles of the attribute values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bp</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">BoxPlot</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">])</span>
<span class="n">bp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BoxPlot

      Interval         Count
----------------------------
(    -inf, -3798.25] |     0
(-3798.25,  3701.75] |     8
( 3701.75,  5256.00] |     8
( 5256.00,  8701.75] |     8
( 8701.75, 16201.75] |     5
(16201.75, 22361.00] |     3
</pre></div>
</div>
</div>
</div>
<p>Any values falling into either of the extreme classes are defined as outliers.
Note that because the income values are non-negative by definition, the lower
outlier class has an inadmissible upper bound meaning that lower outliers would
not be possible for this sample.</p>
<p>The default value for the hinge is <span class="math notranslate nohighlight">\(h=1.5\)</span> in
<code class="docutils literal notranslate"><span class="pre">mapclassify</span></code>. However, this can be specified by the user for an alternative classification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bp1</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">BoxPlot</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">hinge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bp1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BoxPlot

      Interval         Count
----------------------------
(    -inf, -1298.25] |     0
(-1298.25,  3701.75] |     8
( 3701.75,  5256.00] |     8
( 5256.00,  8701.75] |     8
( 8701.75, 13701.75] |     5
(13701.75, 22361.00] |     3
</pre></div>
</div>
</div>
</div>
<p>Doing so will affect the definition of the outlier classes, as well as the
neighboring internal classes.</p>
</section>
<section id="head-tail-breaks">
<h3>Head-tail breaks<a class="headerlink" href="#head-tail-breaks" title="Permalink to this headline">#</a></h3>
<p>The head tail algorithm <span id="id3">[<a class="reference internal" href="references.html#id36" title="Bin Jiang. Head/tail breaks: a new classification scheme for data with a heavy-tailed distribution. The Professional Geographer, 65(3):482–494, Aug 2013. URL: http://dx.doi.org/10.1080/00330124.2012.700499, doi:10.1080/00330124.2012.700499.">Jia13</a>]</span> is based on a recursive partitioning of the data using splits around
iterative means. The splitting process continues until the distributions within each of
the classes no longer display a heavy-tailed distribution in the sense that
there is a balance between the number of smaller and larger values assigned to
each class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ht</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">HeadTailBreaks</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">])</span>
<span class="n">ht</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HeadTailBreaks

      Interval         Count
----------------------------
[ 1892.00,  7230.53] |    20
( 7230.53, 12244.42] |     9
(12244.42, 20714.00] |     1
(20714.00, 22163.00] |     1
(22163.00, 22361.00] |     1
</pre></div>
</div>
</div>
</div>
<p>For data with a heavy-tailed distribution, such as power law and log normal
distributions, the head tail breaks classifier  can be particularly
effective.</p>
</section>
<section id="jenks-caspall-breaks">
<h3>Jenks-Caspall breaks<a class="headerlink" href="#jenks-caspall-breaks" title="Permalink to this headline">#</a></h3>
<p>This approach, as well as the following two, tackles the classification
challenge from a heuristic perspective, rather than from a deterministic one.
Originally proposed by <span id="id4">[<a class="reference internal" href="references.html#id35" title="George F. Jenks and Fred C. Caspall. Error on choroplethic maps: definition, measurement, reduction. Annals of the Association of American Geographers, 61(2):217–244, Jun 1971. URL: http://dx.doi.org/10.1111/j.1467-8306.1971.tb00779.x, doi:10.1111/j.1467-8306.1971.tb00779.x.">JC71</a>]</span>, the Jenks-Caspall classification algorithm
aims to minimize
the sum of absolute deviations around class means. The approach begins with a
prespecified number of classes and an arbitrary initial set of class breaks -
for example using quintiles. The algorithm attempts to improve the objective
function by considering the movement of observations between adjacent classes.
For example, the largest value in the lowest quintile would be considered for
movement into the second quintile, while the lowest value in the second
quintile would be considered for a possible move into the first quintile. The
candidate move resulting in the largest reduction in the objective function
would be made, and the process continues until no other improving moves are
possible. The Jenks-Caspall algorithm is the one-dimension case of the widely
used K-Means algorithm for clustering, which we will see later in this book
when we consider <a class="reference internal" href="10_clustering_and_regionalization.html"><span class="doc std std-doc">Clustering and Regionalization</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">jc5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">JenksCaspall</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">jc5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>JenksCaspall

      Interval         Count
----------------------------
[ 1892.00,  2934.00] |     4
( 2934.00,  4414.00] |     9
( 4414.00,  6399.00] |     5
( 6399.00, 12132.00] |    11
(12132.00, 22361.00] |     3
</pre></div>
</div>
</div>
</div>
</section>
<section id="fisher-jenks-breaks">
<h3>Fisher-Jenks breaks<a class="headerlink" href="#fisher-jenks-breaks" title="Permalink to this headline">#</a></h3>
<p>The second optimal algorithm adopts a dynamic programming approach to minimize
the sum of the absolute deviations around class medians. In contrast to the
Jenks-Caspall algorithm, the Fisher-Jenks alorithm is guaranteed to produce an optimal
classification for a prespecified number of classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">fj5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">FisherJenks</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">fj5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FisherJenks

      Interval         Count
----------------------------
[ 1892.00,  5309.00] |    17
( 5309.00,  9073.00] |     8
( 9073.00, 12132.00] |     4
(12132.00, 17816.00] |     1
(17816.00, 22361.00] |     2
</pre></div>
</div>
</div>
</div>
</section>
<section id="max-p">
<h3>Max-p<a class="headerlink" href="#max-p" title="Permalink to this headline">#</a></h3>
<p>Finally, the max-p classifier adopts the algorithm underlying the max-p region
building method <span id="id5">[<a class="reference internal" href="references.html#id23" title="Juan C. Duque, Luc Anselin, and Sergio J. Rey. The max-p-regions problem. Journal of Regional Science, 52(3):397–419, Dec 2011. URL: http://dx.doi.org/10.1111/j.1467-9787.2011.00743.x, doi:10.1111/j.1467-9787.2011.00743.x.">DAR11</a>]</span> to the case of map classification. It is similar in spirit to
Jenks-Caspall in that it considers greedy swapping between adjacent classes to
improve the objective function. It is a heuristic, however, so unlike
Fisher-Jenks, there is no optimal solution guaranteed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mp5</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">MaxP</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">mp5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MaxP

      Interval         Count
----------------------------
[ 1892.00,  3569.00] |     7
( 3569.00,  5309.00] |    10
( 5309.00,  7990.00] |     5
( 7990.00,  9573.00] |     4
( 9573.00, 22361.00] |     6
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparing-classification-schemes">
<h3>Comparing classification schemes<a class="headerlink" href="#comparing-classification-schemes" title="Permalink to this headline">#</a></h3>
<p>As a special case of clustering, the definition of
the number of classes and the class boundaries pose a problem to the map
designer. Recall that the Freedman-Diaconis rule was said to be optimal,
however; optimality can only be measured relative to a specified objective function.
In the case of Freedman-Diaconis, the objective function is to minimize the
difference between the area under estimated kernel density based on the sample
and the area under the theoretical population distribution that generated the
sample.</p>
<p>This notion of statistical fit is an important one. However, it is not the
only consideration when evaluating classifiers for the purpose of choropleth
mapping. Also relevant is the spatial distribution of the attribute values and
the ability of the classifier to convey a sense of that spatial distribution. As
we shall see, this is not necessarily directly related to the statistical
distribution of the attribute values. We will return to a joint consideration of both
the statistical and spatial distribution of the attribute values when comparing classifiers
later in this chapter.</p>
<p>For map classification, a common optimality criterion
is a measure of fit. In <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code>, the absolute deviation around class
medians (ADCM) is calculated and provides a measure of fit that allows for
comparison of alternative classifiers for the same value of <span class="math notranslate nohighlight">\(k\)</span>. The ADCM
will give us a sense of how “compact” each group is. To see this, we can
compare different classifiers for <span class="math notranslate nohighlight">\(k=5\)</span> on the Mexico data in Figure 2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bunch classifier objects</span>
<span class="n">class5</span> <span class="o">=</span> <span class="n">q5</span><span class="p">,</span> <span class="n">ei5</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">mb5</span><span class="p">,</span> <span class="n">msd</span><span class="p">,</span> <span class="n">fj5</span><span class="p">,</span> <span class="n">jc5</span><span class="p">,</span> <span class="n">mp5</span>
<span class="c1"># Collect ADCM for each classifier</span>
<span class="n">fits</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">adcm</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">class5</span><span class="p">])</span>
<span class="c1"># Convert ADCM scores to a DataFrame</span>
<span class="n">adcms</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fits</span><span class="p">)</span>
<span class="c1"># Add classifier names</span>
<span class="n">adcms</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">class5</span><span class="p">]</span>
<span class="c1"># Add column names to the ADCM</span>
<span class="n">adcms</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ADCM&quot;</span><span class="p">,</span> <span class="s2">&quot;Classifier&quot;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Classifier&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ADCM&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adcms</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e3504164a3a9f3cf1c01a6ffe5acbaa8014b6683f265e07b74d6b8eca5227ba5.png" src="../_images/e3504164a3a9f3cf1c01a6ffe5acbaa8014b6683f265e07b74d6b8eca5227ba5.png" />
</div>
</div>
<p>As is to be expected, the Fisher-Jenks classifier dominates all other k=5
classifiers with an ADCM of 23,729 (remember, lower is better). Interestingly, the equal interval classifier
performs well despite the problems associated with being sensitive to the
extreme values in the distribution. The mean-standard deviation classifier has a
very poor fit due to the skewed nature of the data and the concentrated
assignment of the majority of the observations to the central class.</p>
<p>The ADCM provides a global measure of fit which can be used to compare the
alternative classifiers. As a complement to this global perspective, it can be
revealing to consider how each of the observations in our data was classified across
the alternative approaches. To do this, we can add the class bin attribute (<code class="docutils literal notranslate"><span class="pre">yb</span></code>)
generated by the <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code> classifiers as additional columns in the dataframe to
visualize how they map to observations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Append class values as a separate column</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">q5</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Equal Interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ei5</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Head-Tail Breaks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Maximum Breaks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mb5</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Mean-Standard Deviation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msd</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Fisher-Jenks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fj5</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;Jenks Caspall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jc5</span><span class="o">.</span><span class="n">yb</span>
<span class="n">mx</span><span class="p">[</span><span class="s2">&quot;MaxP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mp5</span><span class="o">.</span><span class="n">yb</span>
</pre></div>
</div>
</div>
</div>
<p>With those in one place, we can display their labels in a heatmap. Note that, since our variable of interest is continuous, we can sort the rows of the table by their value (<code class="docutils literal notranslate"><span class="pre">.sort_values('PCGDP1940')</span></code>) and color each cell according to the label assigned to it by each classifier. To make the heatmap easier to read, we transpose it (<code class="docutils literal notranslate"><span class="pre">.T</span></code>) so that Mexican states are displayed along the horizontal axis and classification schemes are along the vertical one. (see Figure 3)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">mx</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">)[</span>
        <span class="p">[</span>
            <span class="s2">&quot;Head-Tail Breaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Fisher-Jenks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Maximum Breaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Equal Interval&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MaxP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Jenks Caspall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mean-Standard Deviation&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGn&quot;</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;State ID&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/37711bd1e844eb9cd8404dd395f90ea45ddb1bebf05a6db8278935e4231fabf6.png" src="../_images/37711bd1e844eb9cd8404dd395f90ea45ddb1bebf05a6db8278935e4231fabf6.png" />
</div>
</div>
<p>Figure 3 can be challenging to read at first but, once you “decode” it, it packs
a lot of information. Each row includes a full
series of all of our data, classified by an algorithm, with the group to which it
has been assigned encoded on a color scale from light yellow (lowest value group)
to dark green (largest value group). Conversely, each column represents how a given
state is classified across the different schemes considered. Inspection of the table
reveals a number of interesting results. For example, the
only Mexican state that is treated consistently across the k=5 classifiers is
Baja California Norte which is placed in the highest class by all classifiers.
Additionally, the mean-standard deviation classifier has an empty first class due to
the inadmissible upper bound and the over-concentration of values in the central
class (2).</p>
<p>Finally, we can consider a meso-level view of the classification
results by comparing the number of values assigned to each class across the
different classifiers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">counts</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">class5</span><span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Class-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Quantiles</th>
      <th>EqualInterval</th>
      <th>HeadTailBreaks</th>
      <th>MaximumBreaks</th>
      <th>StdMean</th>
      <th>FisherJenks</th>
      <th>JenksCaspall</th>
      <th>MaxP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Class-0</th>
      <td>7</td>
      <td>17</td>
      <td>20</td>
      <td>17</td>
      <td>0</td>
      <td>17</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>Class-1</th>
      <td>6</td>
      <td>9</td>
      <td>9</td>
      <td>11</td>
      <td>1</td>
      <td>8</td>
      <td>9</td>
      <td>10</td>
    </tr>
    <tr>
      <th>Class-2</th>
      <td>6</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>28</td>
      <td>4</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>Class-3</th>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>11</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Class-4</th>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Doing so highlights the similarities between Fisher-Jenks and equal intervals as
the distribution counts are very similar, with the two approaches agreeing on all 17
states assigned to the first class. Indeed, the only observation that
distinguishes the two classifiers is the treatment of Baja California Sur which
is kept in class 1 in equal intervals, but assigned to class 2 by Fisher-Jenks.</p>
</section>
</section>
<section id="color">
<h2>Color<a class="headerlink" href="#color" title="Permalink to this headline">#</a></h2>
<p>Having considered the evaluation of the statistical distribution of
the attribute values and the alternative classification approaches, we turn
to select the symbolization and color scheme. Together with the choice
of classifier, these will determine the overall
effectiveness of the choropleth map in representing the spatial
distribution of the attribute values.</p>
<p>Prior to examining the attribute values it is important to note that, as we will
see in the figures below, the
spatial units for these states are far from homogeneous in their shapes and
sizes. This can have major impacts on our brain’s pattern recognition capabilities,
as we tend to be drawn to the larger polygons, even though they might not be
the most relevant ones for our analysis. Yet, when we considered the
statistical distribution above, each observation was given equal weight. Thus,
the spatial distribution becomes more complicated to evaluate from a visual and
statistical perspective.</p>
<p>The choice of a color scheme for a
choropleth map should be based on the type of variable under consideration
<span id="id6">[<a class="reference internal" href="references.html#id16" title="Cynthia A Brewer, Alan M MacEachren, Linda W Pickle, and Douglas Herrmann. Mapping mortality: evaluating color schemes for choropleth maps. Annals of the Association of American Geographers, 87(3):411–438, 1997.">BMPH97</a>]</span>. Generally, a distinction is drawn between three
types of numerical attributes: sequential, diverging, and qualitative. We will
dig into each below, but we will explore how we can make choropleths in
Python first. The mechanics are the same across different types of data, so it is worth
spending a bit of time first to get the general idea.</p>
<p>We will illustrate it with a quantile map in Figure 4:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">,</span>  <span class="c1"># Data to plot</span>
    <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span>  <span class="c1"># Classification scheme</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGn&quot;</span><span class="p">,</span>  <span class="c1"># Color palette</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add legend</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fmt&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="p">},</span>  <span class="c1"># Remove decimals in legend</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d648d92514fb9d9db1a52ef00dbab78a21e50366eae3fd851222b1b35228cfe6.png" src="../_images/d648d92514fb9d9db1a52ef00dbab78a21e50366eae3fd851222b1b35228cfe6.png" />
</div>
</div>
<p>Making choropleths on geo-tables is an extension of plotting their geometries. We use the same <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> function, but now we also select the column of data we want to encode with color (in our case, <code class="docutils literal notranslate"><span class="pre">PCGDP1940</span></code>). We can also specify the classification scheme using the same names as we saw above with <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code>. In fact, the underlying computation is always performed with <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code>. This approach simply dispatches it so it is more convenient and we can make maps in one line of code. Next, we pick the color scheme. The default color map used by <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> is viridis, which is a multi-hue sequential scheme but, for this example, we pick the yellow-to-green scale from Color Brewer. Finally, we specify that we would like to add a legend, and format it for legibility so that there are no decimals and it reads cleaner.</p>
<section id="sequential-palettes">
<h3>Sequential palettes<a class="headerlink" href="#sequential-palettes" title="Permalink to this headline">#</a></h3>
<p>Sequential color schemes are appropriate for continuous data where the origin is in one end of the series. The <code class="docutils literal notranslate"><span class="pre">PCGDP1940</span></code> column we have been using so far is a good example. In these cases, we want a palette that encodes this feature in its choice of colors. Sequential palettes use a gradient of colors from an origin color to a destination color. The example above, where lowest values are encoded in the lightest yellow and the highest in dark green is a good one. Sequential palettes can also have a shades of a single color. For example, the popular “blues” palette in Color Brewer is a great choice too, shown in Figure 5:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">,</span>  <span class="c1"># Data to plot</span>
    <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span>  <span class="c1"># Classification scheme</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>  <span class="c1"># Color palette</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>  <span class="c1"># Borderline color</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Borderline width</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add legend</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fmt&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span>
    <span class="p">},</span>  <span class="c1"># Remove decimals in legend (for legibility)</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e794ed344a8a75c3c180bf21c6c799d6f0b41b6a62355208e1fc0597152d200e.png" src="../_images/e794ed344a8a75c3c180bf21c6c799d6f0b41b6a62355208e1fc0597152d200e.png" />
</div>
</div>
<p>Note how, in this case, we switch borderlines to black so that we can distinguish states in the lowest category from the white background.</p>
</section>
<section id="diverging-palettes">
<h3>Diverging palettes<a class="headerlink" href="#diverging-palettes" title="Permalink to this headline">#</a></h3>
<p>A slightly different pallete from the sequential one is the so-called “diverging” values palette. This is
useful with continuous data when one wishes to place equal emphasis on mid-range critical values as
well as extremes at both ends of the distribution. Light colors are used to
emphasize the mid-range class, while dark colors with contrasting hues are used
to distinguish the low and high extremes.</p>
<p>To illustrate this with the Mexican
income data, we can derive a new variable which measures the change in a state’s
rank in the income distribution from 1940 to 2000:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create income-based rank table (Rank 1 is highest)</span>
<span class="n">rnk</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[[</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;PCGDP1940&quot;</span><span class="p">,</span> <span class="s2">&quot;PCGDP2000&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Compute change from 1940 to 2000</span>
<span class="n">rnk</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnk</span><span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">rnk</span><span class="p">[</span><span class="s2">&quot;PCGDP2000&quot;</span><span class="p">]</span>
<span class="c1"># Add column with bin class</span>
<span class="n">rnk</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">rnk</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">rnk</span></code> table now contains the change in rank positions of each state between 1940 and 2000, as well as a <code class="docutils literal notranslate"><span class="pre">class</span></code> column that binds together states in the  [-inf, -5), [-5, 0), [0, 5), [5, 20] groups. Note that these are descending ranks, so the wealthiest state in any period has a rank of 1, and therefore when considering the change in ranks, a negative change reflects moving down the income distribution. We can use a divergent palette to signify both intensity of the change in ranks, as well as direction in Figure 6:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mx</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rnk</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlGn&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bdc43ea6672a3a3dfc09bd72082be8e6d07477b87d6bd729148545482cd08612.png" src="../_images/bdc43ea6672a3a3dfc09bd72082be8e6d07477b87d6bd729148545482cd08612.png" />
</div>
</div>
<p>In the map, the red (green) hues are states that have moved downward (upward) in the
income distribution, with the darker hue representing a larger movement.</p>
</section>
<section id="qualitative-palettes">
<h3>Qualitative palettes<a class="headerlink" href="#qualitative-palettes" title="Permalink to this headline">#</a></h3>
<p>Qualitative palettes encode categorical data. In this case, colors do <em>not</em> follow
a gradient but rather imply qualitative differences between classes. That is, observations
in one group are not more or less, above or below those in other groups, rather just
different.</p>
<p>The Mexico data set also has several variables that
are on a nominal measurement scale. One of these is a region definition variable
that groups individual states in contiguous clusters of similar characteristics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mx</span><span class="p">[</span><span class="s2">&quot;HANSON98&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.0
1    2.0
2    2.0
3    3.0
4    2.0
Name: HANSON98, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This aggregation scheme partitions Mexico into five regions, recorded with
the numbers 1 to 5 in the table. A naive (and
incorrect) way to display this would be to treat the region variable as
sequential, visualized in Figure 7:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;HANSON98&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/53a27c38775761315ed4bdac226b6bd8d58e8cd4296f3cf3f989a5f84a8b378d.png" src="../_images/53a27c38775761315ed4bdac226b6bd8d58e8cd4296f3cf3f989a5f84a8b378d.png" />
</div>
</div>
<p>This is not correct because the region variable is not on an interval scale, so
the differences between the values have no quantitative significance, but rather
the values simply indicate region membership. However, the choropleth in Figure 7 gives
a clear visual cue that regions in the south have larger values
than those in the north, as the color map implies an intensity gradient.</p>
<p>A more appropriate visualization
is to use a “qualitative” color palette, which is used if you specify that
the variable is categorical (Figure 8).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;HANSON98&quot;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9182fad35fbe92eef184ed31198822d7a6d1582a1463899bce83b62e37cc65e2.png" src="../_images/9182fad35fbe92eef184ed31198822d7a6d1582a1463899bce83b62e37cc65e2.png" />
</div>
</div>
</section>
</section>
<section id="advanced-topics">
<h2>Advanced topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">#</a></h2>
<section id="user-defined-choropleths">
<h3>User-defined choropleths<a class="headerlink" href="#user-defined-choropleths" title="Permalink to this headline">#</a></h3>
<p>In this last section of the chapter, we consider bespoke partitions of the data that do not follow any particular algorithm but instead are informed by, for example, domain knowledge. Consider the case of classifying income in a policy context. Imagine we wanted to explore the distribution of areas with less than <span class="math notranslate nohighlight">\(\$\)</span>10,000, then those between <span class="math notranslate nohighlight">\(\$\)</span>10,000 and <span class="math notranslate nohighlight">\(\$\)</span>12,500; <span class="math notranslate nohighlight">\(\$\)</span>12,500 and <span class="math notranslate nohighlight">\(\$\)</span>15,000; and greater than <span class="math notranslate nohighlight">\(\$\)</span>15,000. These boundaries are arbitrary but may be tied to specific policies in which the first group is targetted in one particular way, the second and third in different ways, and the fourth is not part of the policy, for example.</p>
<p>To create a choropleth that reflects this partitioning of the data, we can use the <code class="docutils literal notranslate"><span class="pre">UserDefined</span></code> classifier in <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classi</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">UserDefined</span><span class="p">(</span>
    <span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP2000&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">12500</span><span class="p">,</span> <span class="mi">15000</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">classi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UserDefined

      Interval         Count
----------------------------
[ 8684.00, 10000.00] |     2
(10000.00, 12500.00] |     7
(12500.00, 15000.00] |     1
(15000.00, 54349.00] |    22
</pre></div>
</div>
</div>
</div>
<p>If we now want to display these classes on a map, we can use a similar approach to how we have seen above, or use the built-in plotting method in <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code> to generate Figure 9:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">mx</span><span class="p">,</span>  <span class="c1"># Use geometries in the geo-table</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add a legend</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper right&quot;</span>
    <span class="p">},</span>  <span class="c1"># Place legend on top right corner</span>
    <span class="n">axis_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Remove axis</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis_r&quot;</span><span class="p">,</span>  <span class="c1"># Use reverse Viridis</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4fd7020e040d5c03972c0c7a3387e976c5dd6ddff9964178606cdcc1d4e6e84a.png" src="../_images/4fd7020e040d5c03972c0c7a3387e976c5dd6ddff9964178606cdcc1d4e6e84a.png" />
</div>
</div>
<p>Since we want to draw attention to the classes at the bottom of the scale, we use the reverse viridis (<code class="docutils literal notranslate"><span class="pre">viridis_r</span></code>) palette. Thus, Figure 9 shows in purple the areas not targeted by our hypothetical policy.</p>
<p>The approach above is useful in that it is based on <code class="docutils literal notranslate"><span class="pre">mapclassify</span></code> and thus provides a unified interface shared with all the algorithms seen above. An alternative one involves using the <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code> method, which allows us to easily include a legend too in Figure 10:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Classify values specifying bins</span>
<span class="n">lbls</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
    <span class="n">mx</span><span class="p">[</span><span class="s2">&quot;PCGDP2000&quot;</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">12500</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># Dynamically assign to geo-table and plot with a legend</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lbls</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis_r&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Remove axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b613b92987d1248fffba64a14f6d4d97b0076c95a70fe007bf6b38c532dd1d77.png" src="../_images/b613b92987d1248fffba64a14f6d4d97b0076c95a70fe007bf6b38c532dd1d77.png" />
</div>
</div>
</section>
<section id="pooled-classifications">
<h3>Pooled classifications<a class="headerlink" href="#pooled-classifications" title="Permalink to this headline">#</a></h3>
<p>Sometimes choropleths exist as part of larger figures that may include more choropleths. In some cases, each of them can be best considered as an independent map, and then everything we have seen so far applies directly. In other instances, we may want to create a single classification of values <em>across</em> the maps and use it consistently. For those situations, we can create <em>pooled</em> classifications that consider all the values across the series.</p>
<p>To illustrate this approach, we will create a figure with choropleths of GDP per capita in 1940, 1960, 1980, and 2000; and we will use the same classification across the four maps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List the years we want of pc GDP</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PCGDP1940&quot;</span><span class="p">,</span> <span class="s2">&quot;PCGDP1960&quot;</span><span class="p">,</span> <span class="s2">&quot;PCGDP1980&quot;</span><span class="p">,</span> <span class="s2">&quot;PCGDP2000&quot;</span><span class="p">]</span>
<span class="c1"># Create pooled classification</span>
<span class="n">pooled</span> <span class="o">=</span> <span class="n">mapclassify</span><span class="o">.</span><span class="n">Pooled</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">years</span><span class="p">],</span> <span class="n">classifier</span><span class="o">=</span><span class="s2">&quot;Quantiles&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pooled</span></code> object contains a lot of information on the classification and we can use it to generate a figure with the maps. To do that, we rely also on the <code class="docutils literal notranslate"><span class="pre">UserDefined</span></code> classifier we have just seen in the previous section to create a multi-pane figure showing the per capita income as it changes over time (Figure 11).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up figure with four axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1"># Flatten the array of axis so you can loop over</span>
<span class="c1"># in one dimension</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="c1"># Loop over each year</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="n">mx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">y</span><span class="p">,</span>  <span class="c1"># Year to plot</span>
        <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;UserDefined&quot;</span><span class="p">,</span>  <span class="c1"># Use our own bins</span>
        <span class="n">classification_kwds</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;bins&quot;</span><span class="p">:</span> <span class="n">pooled</span><span class="o">.</span><span class="n">global_classifier</span><span class="o">.</span><span class="n">bins</span>
        <span class="p">},</span>  <span class="c1"># Use global bins</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add a legend</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="c1"># Plot on the corresponding axis</span>
    <span class="p">)</span>
    <span class="c1"># Remove axis</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="c1"># Name the subplot with the name of the column</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># Tight layout to better use space</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># Display figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3c5eff625f00313c614fcad456ea80355f839e6fa911b3e4b9318658b5f46d06.png" src="../_images/3c5eff625f00313c614fcad456ea80355f839e6fa911b3e4b9318658b5f46d06.png" />
</div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>In this chapter we have considered the construction of choropleth maps for
spatial data visualization. The key issues of the choice of classification
scheme, variable measurement scale, spatial configuration and color palettes
were illustrated using Pysal’s map classification module together with other
related packages in the Python data stack.</p>
<p>Choropleth maps are a central tool in the geographic data science toolkit, as
they provide powerful visualizations of the spatial distribution of attribute
values. We have only touched on the basic concepts in this chapter, as there is
much more that can be said about cartographic theory and the design of effective
choropleth maps. Readers interested in pursuing this literature are encouraged
to see the references cited.</p>
<p>At the same time, given the philosophy underlying Pysal, the methods we cover
here are sufficient for exploratory data analysis where the rapid and flexible
generation of views is critical to the work flow. Once the analysis is complete,
and the final presentation quality maps are to be generated, there are excellent
packages in the data stack that the user can turn to.</p>
</section>
<section id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p>A variable (such as population density measured for census tracts in a metropolitan area) can display a high degree of skewness. That is, the distribution may be very asymmetric, either with a few very high values and a bulk of low ones; or a few very low values with a bulk of high values. What is an appropriate choice for a choropleth classification for a skewed variable?</p></li>
<li><p>Provide two solutions to the problem of ties when applying quantile classification to the following series: <span class="math notranslate nohighlight">\(y=[2,2,2,2,2,2,4,7,8,9,20,21]\)</span> and <span class="math notranslate nohighlight">\(k=4\)</span>. Discuss the merits of each approach.</p></li>
<li><p>Which classifiers are appropriate for data that displays a high degree of multi-modality in its statistical distribution?</p></li>
<li><p>Are there any colormaps that work well for multi-modal data?</p></li>
<li><p>Contrast and compare classed choropleth maps with class-less (i.e., continuous-scale) choropleth maps? What are the strengths and limitations of each type of visualization for spatial data?</p></li>
<li><p>In what ways do choropleth classifiers treat intra-class and inter-class heterogeneity differently? What are the implications of these choices?</p></li>
<li><p>To what extent do most commonly employed choropleth classification methods take the geographical distribution of the variable into consideration? Can you think of ways to incorporate the spatial features of a variable into a classification for a choropleth map?</p></li>
<li><p>Discuss the similarities between the choice of the number of classes in choropleth mapping, on the one hand, and the determination of the number of clusters in a data set on the other. What aspects of choropleth mapping differentiate the former from the latter?</p></li>
<li><p>The Fisher-Jenks classifier will always have more internally homogeneous classes than other k-classifiers. Given this, why might one decide on choosing a different k-classifier for a particular data set?</p></li>
</ol>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">#</a></h2>
<p>We have but touched the surface of the large literature on choropleth mapping in particular, and geovisualization more generally. Readers interested in delving deeper into these topices are directed to the following:</p>
<ul class="simple">
<li><p><span id="id7">[<a class="reference internal" href="references.html#id84" title="Terry A Slocum, Robert B McMaster, Fritz C Kessler, and Hugh H Howard. Thematic Cartography and Geovisualization. Pearson, 2014.">SMKH14</a>]</span>. Thematic Cartography and Geovisualization. Pearson.</p></li>
<li><p><span id="id8">[]</span>. “Choropleth map legend design for visualizing community health disparities.” <em>International Journal of Health Geographics</em>, 8: 1-11.</p></li>
<li><p><span id="id9">[]</span>. “A comparison of optimal classification strategies for choroplethic displays of spatiall aggregated data.” <em>International Journal of Geographc Information Systems</em>, 10: 405-424.</p></li>
<li><p><span id="id10">[]</span>. Designing better maps: A guide for GIS Users. ESRI press.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../intro_part_ii.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Overview</p>
      </div>
    </a>
    <a class="right-next"
       href="06_spatial_autocorrelation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Global Spatial Autocorrelation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#principles">Principles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-data-classification">Quantitative data classification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equal-intervals">Equal intervals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantiles">Quantiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-standard-deviation">Mean-standard deviation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-breaks">Maximum breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot">Boxplot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#head-tail-breaks">Head-tail breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jenks-caspall-breaks">Jenks-Caspall breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fisher-jenks-breaks">Fisher-Jenks breaks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#max-p">Max-p</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-classification-schemes">Comparing classification schemes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#color">Color</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-palettes">Sequential palettes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diverging-palettes">Diverging palettes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qualitative-palettes">Qualitative palettes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-topics">Advanced topics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-defined-choropleths">User-defined choropleths</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pooled-classifications">Pooled classifications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sergio J. Rey, Dani Arribas-Bel, Levi J. Wolf
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2020.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>